<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.552">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>Linear Models</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script>window.backupDefine = window.define; window.define = undefined;</script><script src="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.js"></script>
  <script>document.addEventListener("DOMContentLoaded", function () {
 var mathElements = document.getElementsByClassName("math");
 var macros = [];
 for (var i = 0; i < mathElements.length; i++) {
  var texText = mathElements[i].firstChild;
  if (mathElements[i].tagName == "SPAN") {
   katex.render(texText.data, mathElements[i], {
    displayMode: mathElements[i].classList.contains('display'),
    throwOnError: false,
    macros: macros,
    fleqn: false
   });
}}});
  </script>
  <script>window.define = window.backupDefine; window.backupDefine = undefined;</script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.15.1/dist/katex.min.css">

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a href="https://www.vectorbyte.org" class="navbar-brand navbar-brand-logo">
    <img src="./graphics/vblogoedit.pdf" alt="" class="navbar-logo">
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./about.html"> 
<span class="menu-text">About</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./schedule2023.html"> 
<span class="menu-text">Schedule</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./materials.html"> 
<span class="menu-text">Materials</span></a>
  </li>  
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item compact">
    <a class="nav-link" href="https://github.com/VectorByteOrg/vectorbyte-training4"> <i class="bi bi-github" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
  <li class="nav-item compact">
    <a class="nav-link" href="https://twitter.com/vectorbite_rcn"> <i class="bi bi-twitter" role="img">
</i> 
<span class="menu-text"></span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#welcome-to-the-vectorbyte-2023-section-on-linear-models" id="toc-welcome-to-the-vectorbyte-2023-section-on-linear-models" class="nav-link active" data-scroll-target="#welcome-to-the-vectorbyte-2023-section-on-linear-models">Welcome to the VectorByte 2023 section on Linear Models</a></li>
  <li><a href="#linear-models-regression" id="toc-linear-models-regression" class="nav-link" data-scroll-target="#linear-models-regression">Linear Models: Regression</a>
  <ul class="collapse">
  <li><a href="#introduction" id="toc-introduction" class="nav-link" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#exploring-the-data" id="toc-exploring-the-data" class="nav-link" data-scroll-target="#exploring-the-data">Exploring the data</a></li>
  <li><a href="#correlations" id="toc-correlations" class="nav-link" data-scroll-target="#correlations">Correlations</a></li>
  <li><a href="#transformations-and-allometric-scaling" id="toc-transformations-and-allometric-scaling" class="nav-link" data-scroll-target="#transformations-and-allometric-scaling">Transformations and allometric scaling</a></li>
  <li><a href="#performing-the-regression-analysis" id="toc-performing-the-regression-analysis" class="nav-link" data-scroll-target="#performing-the-regression-analysis">Performing the Regression analysis</a>
  <ul class="collapse">
  <li><a href="#exercise" id="toc-exercise" class="nav-link" data-scroll-target="#exercise">Exercise</a></li>
  <li><a href="#plotting-the-fitted-regression-model" id="toc-plotting-the-fitted-regression-model" class="nav-link" data-scroll-target="#plotting-the-fitted-regression-model">Plotting the fitted Regression model</a></li>
  </ul></li>
  <li><a href="#model-diagnostics" id="toc-model-diagnostics" class="nav-link" data-scroll-target="#model-diagnostics">Model diagnostics</a></li>
  <li><a href="#reporting-the-model" id="toc-reporting-the-model" class="nav-link" data-scroll-target="#reporting-the-model">Reporting the model</a></li>
  </ul></li>
  <li><a href="#linear-models-analysis-of-variance" id="toc-linear-models-analysis-of-variance" class="nav-link" data-scroll-target="#linear-models-analysis-of-variance">Linear Models: Analysis of variance</a>
  <ul class="collapse">
  <li><a href="#introduction-1" id="toc-introduction-1" class="nav-link" data-scroll-target="#introduction-1">Introduction</a></li>
  <li><a href="#what-is-anova" id="toc-what-is-anova" class="nav-link" data-scroll-target="#what-is-anova">What is ANOVA?</a></li>
  <li><a href="#calculating-the-anova-test-statistic" id="toc-calculating-the-anova-test-statistic" class="nav-link" data-scroll-target="#calculating-the-anova-test-statistic">Calculating the ANOVA test statistic</a>
  <ul class="collapse">
  <li><a href="#degrees-of-freedom" id="toc-degrees-of-freedom" class="nav-link" data-scroll-target="#degrees-of-freedom">Degrees of freedom</a></li>
  <li><a href="#the-f-value-or-ratio" id="toc-the-f-value-or-ratio" class="nav-link" data-scroll-target="#the-f-value-or-ratio">The F-Value (or Ratio)</a></li>
  <li><a href="#the-r2" id="toc-the-r2" class="nav-link" data-scroll-target="#the-r2">The <span class="math inline">R^{2}</span></a></li>
  </ul></li>
  <li><a href="#an-example-anova" id="toc-an-example-anova" class="nav-link" data-scroll-target="#an-example-anova">An example ANOVA</a>
  <ul class="collapse">
  <li><a href="#the-data" id="toc-the-data" class="nav-link" data-scroll-target="#the-data">The data</a></li>
  <li><a href="#exploring-the-data-with-boxplots" id="toc-exploring-the-data-with-boxplots" class="nav-link" data-scroll-target="#exploring-the-data-with-boxplots">Exploring the data with boxplots</a></li>
  <li><a href="#an-alternative-to-barplots" id="toc-an-alternative-to-barplots" class="nav-link" data-scroll-target="#an-alternative-to-barplots">An alternative to barplots</a></li>
  </ul></li>
  <li><a href="#analysis-of-variance" id="toc-analysis-of-variance" class="nav-link" data-scroll-target="#analysis-of-variance">Analysis of variance</a>
  <ul class="collapse">
  <li><a href="#are-the-factors-independent" id="toc-are-the-factors-independent" class="nav-link" data-scroll-target="#are-the-factors-independent">Are the factors independent?</a></li>
  </ul></li>
  <li><a href="#the-chi-square-test-and-count-data" id="toc-the-chi-square-test-and-count-data" class="nav-link" data-scroll-target="#the-chi-square-test-and-count-data">The Chi-square test and count data</a>
  <ul class="collapse">
  <li><a href="#the-chi-square-test-with-the-wing-length-data" id="toc-the-chi-square-test-with-the-wing-length-data" class="nav-link" data-scroll-target="#the-chi-square-test-with-the-wing-length-data">The Chi-square test with the wing length data</a></li>
  </ul></li>
  <li><a href="#saving-data" id="toc-saving-data" class="nav-link" data-scroll-target="#saving-data">Saving data</a></li>
  </ul></li>
  <li><a href="#linear-models-multiple-explanatory-variables" id="toc-linear-models-multiple-explanatory-variables" class="nav-link" data-scroll-target="#linear-models-multiple-explanatory-variables">Linear Models: Multiple explanatory variables</a>
  <ul class="collapse">
  <li><a href="#introduction-2" id="toc-introduction-2" class="nav-link" data-scroll-target="#introduction-2">Introduction</a></li>
  <li><a href="#an-example" id="toc-an-example" class="nav-link" data-scroll-target="#an-example">An example</a>
  <ul class="collapse">
  <li><a href="#exploring-the-data-1" id="toc-exploring-the-data-1" class="nav-link" data-scroll-target="#exploring-the-data-1">Exploring the data</a></li>
  <li><a href="#boxplots-within-groups" id="toc-boxplots-within-groups" class="nav-link" data-scroll-target="#boxplots-within-groups">Boxplots within groups</a></li>
  <li><a href="#lattice-again" id="toc-lattice-again" class="nav-link" data-scroll-target="#lattice-again"><code>lattice</code> again</a></li>
  <li><a href="#barplots-again" id="toc-barplots-again" class="nav-link" data-scroll-target="#barplots-again">Barplots again</a></li>
  <li><a href="#plotting-means-and-confidence-intervals" id="toc-plotting-means-and-confidence-intervals" class="nav-link" data-scroll-target="#plotting-means-and-confidence-intervals">Plotting means and confidence intervals</a></li>
  </ul></li>
  <li><a href="#fitting-the-linear-model" id="toc-fitting-the-linear-model" class="nav-link" data-scroll-target="#fitting-the-linear-model">Fitting the linear model</a></li>
  </ul></li>
  <li><a href="#linear-models-multiple-variables-with-interactions" id="toc-linear-models-multiple-variables-with-interactions" class="nav-link" data-scroll-target="#linear-models-multiple-variables-with-interactions">Linear Models: Multiple variables with interactions</a>
  <ul class="collapse">
  <li><a href="#introduction-3" id="toc-introduction-3" class="nav-link" data-scroll-target="#introduction-3">Introduction</a>
  <ul class="collapse">
  <li><a href="#section-aims" id="toc-section-aims" class="nav-link" data-scroll-target="#section-aims">Section aims</a></li>
  <li><a href="#formulae-with-interactions-in-r" id="toc-formulae-with-interactions-in-r" class="nav-link" data-scroll-target="#formulae-with-interactions-in-r">Formulae with interactions in R</a></li>
  </ul></li>
  <li><a href="#model-1-aedes-aegypti-wing-length" id="toc-model-1-aedes-aegypti-wing-length" class="nav-link" data-scroll-target="#model-1-aedes-aegypti-wing-length">Model 1: <em>Aedes aegypti</em> wing length</a></li>
  <li><a href="#model-2-ancova-body-weight-in-odonata" id="toc-model-2-ancova-body-weight-in-odonata" class="nav-link" data-scroll-target="#model-2-ancova-body-weight-in-odonata">Model 2 (ANCOVA): Body Weight in Odonata</a></li>
  </ul></li>
  <li><a href="#model-simplification" id="toc-model-simplification" class="nav-link" data-scroll-target="#model-simplification">Model simplification</a>
  <ul class="collapse">
  <li><a href="#introduction-4" id="toc-introduction-4" class="nav-link" data-scroll-target="#introduction-4">Introduction</a>
  <ul class="collapse">
  <li><a href="#section-aims-1" id="toc-section-aims-1" class="nav-link" data-scroll-target="#section-aims-1">Section aims</a></li>
  <li><a href="#the-process-of-model-simplification" id="toc-the-process-of-model-simplification" class="nav-link" data-scroll-target="#the-process-of-model-simplification">The process of model simplification</a></li>
  </ul></li>
  <li><a href="#an-example-1" id="toc-an-example-1" class="nav-link" data-scroll-target="#an-example-1">An example</a></li>
  <li><a href="#a-maximal-model" id="toc-a-maximal-model" class="nav-link" data-scroll-target="#a-maximal-model">A Maximal model</a></li>
  <li><a href="#a-better-maximal-model" id="toc-a-better-maximal-model" class="nav-link" data-scroll-target="#a-better-maximal-model">A better maximal model</a></li>
  <li><a href="#model-simplification-1" id="toc-model-simplification-1" class="nav-link" data-scroll-target="#model-simplification-1">Model simplification</a></li>
  <li><a href="#exercise-1" id="toc-exercise-1" class="nav-link" data-scroll-target="#exercise-1">Exercise</a></li>
  </ul></li>
  <li><a href="#group-project" id="toc-group-project" class="nav-link" data-scroll-target="#group-project">Group project</a></li>
  </ul>
</nav>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Linear Models</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p><a href="./materials.html">Main Materials</a></p>
<section id="welcome-to-the-vectorbyte-2023-section-on-linear-models" class="level3">
<h3 class="anchored" data-anchor-id="welcome-to-the-vectorbyte-2023-section-on-linear-models">Welcome to the VectorByte 2023 section on Linear Models</h3>
<p>This section will cover: * Regression * ANOVA * Multiple Explanatory Variables * Multiple Explanatory Variables with Interactions * Model Simplification</p>
</section>
<section id="linear-models-regression" class="level1">
<h1>Linear Models: Regression</h1>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>Linear Regression is a class of <a href="https://en.wikipedia.org/wiki/Linear_model">Linear Models</a> that is frequently a good choice if both, your response (dependent) and your predictor (independent) variables are continuous. In this section you will learn:</p>
<ul>
<li><p>To <em>explore</em> your data in order to determine whether a Linear Model is a good choice by</p>
<ul>
<li>Visualizing your data (in <code>R</code>)</li>
<li>Calculating correlations between variables</li>
</ul></li>
<li><p>To <em>fit</em> a Linear Regression Model to data</p></li>
<li><p>To determine whether the Model fits adequately your data (its “significance”) by</p>
<ul>
<li>Plotting the data and the fitted Model together</li>
<li>Calculating goodness of fit measures and statistics</li>
<li>Using diagnostic plots</li>
</ul></li>
</ul>
<p>It is expected that you have already been introduced to, or are familiar with the concepts (and/or theory) underlying Linear Models. If not, you may want to watch the <a href="https://drive.google.com/drive/folders/12Sj56wHX6vcAnp9GE9qQ1gIXbn7QRHU2?usp=sharing">video</a>.</p>
<p>We will use the genome size data.</p>
<p>So,</p>
<p><span class="math inline">\star</span> Open R and <code>setwd</code> to your <code>code</code> directory.</p>
<p><span class="math inline">\star</span> Create a new blank script called <code>Regression.R</code> and add some introductory comments.</p>
<p><span class="math inline">\star</span> Add code to your script to load the genome size data into R and check it (again, using the relative path prefix `<code>, assuming that you working directory is</code>code`):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>genome <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">'activities/data/GenomeSize.csv'</span>,<span class="at">stringsAsFactors =</span> T) </span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(genome)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>    Suborder    Family              Species GenomeSize GenomeSE GenomeN
1 Anisoptera Aeshnidae    Aeshna canadensis       2.20       NA       1
2 Anisoptera Aeshnidae    Aeshna constricta       1.76     0.06       4
3 Anisoptera Aeshnidae       Aeshna eremita       1.85       NA       1
4 Anisoptera Aeshnidae Aeshna tuberculifera       1.78     0.10       2
5 Anisoptera Aeshnidae       Aeshna umbrosa       2.00       NA       1
6 Anisoptera Aeshnidae    Aeshna verticalis       1.59       NA       1
  BodyWeight TotalLength HeadLength ThoraxLength AdbdomenLength ForewingLength
1      0.159       67.58       6.83        11.81          48.94          45.47
2      0.228       71.97       6.84        10.72          54.41          46.00
3      0.312       78.80       6.27        16.19          56.33          51.24
4      0.218       72.44       6.62        12.53          53.29          49.84
5      0.207       73.05       4.92        11.11          57.03          46.51
6      0.220       66.25       6.48        11.64          48.13          45.91
  HindwingLength ForewingArea HindwingArea MorphologyN
1          45.40       369.57       483.61           2
2          45.48       411.15       517.38           3
3          49.47       460.72       574.33           1
4          48.82       468.74       591.42           2
5          45.97       382.48       481.44           1
6          44.91       400.40       486.97           1</code></pre>
</div>
</div>
</section>
<section id="exploring-the-data" class="level2">
<h2 class="anchored" data-anchor-id="exploring-the-data">Exploring the data</h2>
<p>We can use <code>plot</code> to create a scatterplot between two variables. If you have a set of variables to explore, writing code for each plot is tiresome, so R provides a function <code>pairs</code>, which creates a grid of scatter plots between each pair of variables. This will make a plot off all the different combinations in your dataset to better explore the dataset. All it needs is a dataset.</p>
<p>First, plot all pairs:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(repr); <span class="fu">options</span>(<span class="at">repr.plot.res =</span> <span class="dv">100</span>, <span class="at">repr.plot.width =</span> <span class="dv">10</span>, <span class="at">repr.plot.height =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(genome)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_mod_activity_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br> That’s messy! There are too many columns that we are plotting against each other, so its hard to get a meaningful picture (literally). So let’s try color-coding the scatterplot markers by suborder:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(genome, <span class="at">col=</span>genome<span class="sc">$</span>Suborder)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_mod_activity_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br> The result is still too messy! There are far too many variables in <code>genome</code> for this to be useful. Before we proceed further,</p>
<p><span class="math inline">\star</span> Add <code>pairs(genome, col=genome$Suborder)</code> into your script and run the code:</p>
<p>So, we need to cut down the data to fewer variables. Previously (Experimental design section) we used indices to select colours; here, we can use indices to select columns from the data frame. This again uses square brackets (<code>x[]</code>), but a data frame has two dimensions, rows and columns, so you need to provide an index for each dimension, separated by commas. If an index is left blank, then all of that dimension (i.e.&nbsp;all rows or columns) are selected. Try the following to re-acquaint yourself to access data frame content using indices:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(repr); <span class="fu">options</span>(<span class="at">repr.plot.res =</span> <span class="dv">100</span>, <span class="at">repr.plot.width =</span> <span class="dv">8</span>, <span class="at">repr.plot.height =</span> <span class="dv">8</span>) <span class="co"># change plot size</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create a small data frame:</span></span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">A =</span> <span class="fu">c</span>(<span class="st">"a"</span>, <span class="st">"b"</span>, <span class="st">"c"</span>, <span class="st">"d"</span>, <span class="st">"e"</span>), <span class="at">B =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>))</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>dat[<span class="dv">1</span>, ] <span class="co"># select row 1 (all columns selected)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  A B
1 a 1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>dat[, <span class="dv">2</span>] <span class="co"># select column 2 (all rows selected)</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1 2 3 4 5</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>dat[<span class="dv">2</span>, <span class="dv">1</span>] <span class="co"># select row 2, column 1</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "b"</code></pre>
</div>
</div>
<p><br> Now let’s get resume the actual analysis. We will look at five key variables: genome size, body weight, total length, forewing length and forewing area. If you look at the output of <code>str(genome)</code>, you’ll see that these are in columns 4, 7, 8, 12 and 14. We can record the indices of these columns and use this to select the data in the pairs plot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>morpho_vars <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">12</span>, <span class="dv">14</span>) <span class="co"># store the indices</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(genome[, morpho_vars], <span class="at">col =</span> genome<span class="sc">$</span>Suborder)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_mod_activity_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><span class="math inline">\star</span> Add the code above to your script and run it.</p>
<p>In the figure above, each scatterplot is shown twice, with the variables swapping between the <span class="math inline">x</span> and <span class="math inline">y</span> axes. You can see immediately that the relationships between the four morphological measurements and genome size are fairly scattered but that the plots comparing morphology show much clearer relationships.</p>
</section>
<section id="correlations" class="level2">
<h2 class="anchored" data-anchor-id="correlations">Correlations</h2>
<p>One way of summarising how strong the pair-wise relationships between these variables is to calculate a correlation coefficient. Pearson correlations look at the difference of each point from the mean of each variable (and since it uses means, it is a parametric statistic).</p>
<p>It is calculated using the differences from the mean on each axis. The key calculation is — for each point – to get the product of the differences on each axis and add them up. If the points are mostly top left (<span class="math inline">-x</span>, <span class="math inline">y</span>) or bottom right (<span class="math inline">x</span>, <span class="math inline">-y</span>) then these products are mostly negative (<span class="math inline">-xy</span>); if the points are mostly top right (<span class="math inline">x</span>, <span class="math inline">y</span>) or bottom left (<span class="math inline">-x</span>, <span class="math inline">-y</span>) then the products are mostly positive (<span class="math inline">xy</span>).</p>
<hr>
<p><img src="corr.png" alt="Pearson's Correlation Coefficient" width="800px"></p>
<p><small></small></p><small>
<center>
Illustration of what the Pearson correlation coefficient means.
</center>
</small><p><small></small></p>
<hr>
<p>The plots above show three clear cases where all the values of <span class="math inline">xy</span> are negative or positive or where both are present and sum to zero. The Pearson correlation coefficient simply scales these sums of <span class="math inline">xy</span> to be between -1 (perfectly negatively correlated) and 1 (perfectly positively correlated) via zero (no correlation). Specifically, this correlation coefficient (<span class="math inline">r</span>) is equal to the average product of the standardized values of the two variables (let’s call them <span class="math inline">x</span> and <span class="math inline">y</span>):</p>
<p><span class="math display">r_{xy}={\frac{\sum _{i=1}^{n}\left({\frac {x_{i}-{\bar {x}}}{s_{x}}}\right)\left({\frac {y_{i}-{\bar {y}}}{s_{y}}}\right)}{n-1}}</span></p>
<p>where,</p>
<ul>
<li><p><span class="math inline">n</span> is sample size</p></li>
<li><p><span class="math inline">x_i, y_i</span> are the individual sample points indexed with <span class="math inline">i</span> (<span class="math inline">i = 1,2,\ldots, n</span>)</p></li>
<li><p>$ {x} = $ is the the sample mean.</p></li>
<li><p>$ s_x = $ (sample standard deviation)</p></li>
<li><p>The quantities <span class="math inline">\left({\frac {x_{i}-{\bar {x}}}{s_{x}}}\right)</span> and <span class="math inline">\left(\frac{y_i-\bar{y}}{s_y} \right)</span> are the Z-scores (aka <em>standard scores</em>) of <span class="math inline">x</span> and <span class="math inline">y</span>. This conversion of the raw scores (<span class="math inline">x_i</span>’s and <span class="math inline">y_i</span>’s) to Z-scores is called standardizing (or sometimes, normalizing).</p></li>
</ul>
<p>Thus the coefficient (<span class="math inline">r_{xy}</span>) will be positive (negative) if the <span class="math inline">x_i</span> and <span class="math inline">y_i</span>’s tend to move in the same (opposite) direction relative to their respective means (as illustrated in the figure above).</p>
<p>In <code>R</code>, we will use two functions to look at correlations. The first is <code>cor</code>, which can calculate correlations between pairs of variables, so is a good partner for <code>pairs</code> plots. The second is <code>cor.test</code>, which can only compare a single pair of variables, but uses a <span class="math inline">t</span> test to assess whether the correlation is significant.</p>
<p><span class="math inline">\star</span> Try the following (and include it in your R script file):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(genome[, morpho_vars], <span class="at">use =</span> <span class="st">"pairwise"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>               GenomeSize BodyWeight TotalLength ForewingLength ForewingArea
GenomeSize      1.0000000  0.3430934   0.3407077      0.2544432    0.3107247
BodyWeight      0.3430934  1.0000000   0.9167995      0.8944228    0.9198821
TotalLength     0.3407077  0.9167995   1.0000000      0.9225974    0.9077555
ForewingLength  0.2544432  0.8944228   0.9225974      1.0000000    0.9829803
ForewingArea    0.3107247  0.9198821   0.9077555      0.9829803    1.0000000</code></pre>
</div>
</div>
<p><br> This is the correlation matrix. Then:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor.test</span>(genome<span class="sc">$</span>GenomeSize, genome<span class="sc">$</span>TotalLength, <span class="at">use =</span> <span class="st">"pairwise"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's product-moment correlation

data:  genome$GenomeSize and genome$TotalLength
t = 3.5507, df = 96, p-value = 0.0005972
alternative hypothesis: true correlation is not equal to 0
95 percent confidence interval:
 0.1526035 0.5049895
sample estimates:
      cor 
0.3407077 </code></pre>
</div>
</div>
<p><br> The <code>use='pairwise'</code> tells R to omit observations with missing data and use complete pairs of observations. The first function confirms our impressions from the graphs: the correlations between genome size and morphology are positive but comparatively weak and the correlations between morphological measurements are positive and very strong (i.e.&nbsp;close to 1). The correlation test tells us that genome size and body length are positively correlated (r=0.34, <span class="math inline">t</span> = 3.5507, df = 96, <span class="math inline">p</span> = 0.0006).</p>
<p>Also, in case you are wondering about what the t-value in the <code>cor.test</code>&nbsp;signifies: &nbsp; &nbsp;</p>
<p>The t-test is used within <code>cor.test</code> to establish if the correlation coefficient is significantly different from zero, that is,&nbsp;to&nbsp;test if&nbsp;there is a significant&nbsp;association between the two variables. The t-test, in general, can be used to test if the mean of a sample&nbsp;is significantly&nbsp;different from some reference value (1-sample t-test). Here, the “mean of the sample” is the observed correlation coefficient, and the reference value is 0 (the null hypothesis, that there is no association).</p>
</section>
<section id="transformations-and-allometric-scaling" class="level2">
<h2 class="anchored" data-anchor-id="transformations-and-allometric-scaling">Transformations and allometric scaling</h2>
<p>There is one problem with the correlations above: <em>the correlation coefficient calculation assumes a straight line relationship</em>. Some of the scatterplots above are fairly straight but there are some strongly curved relationships. This is due to <a href="https://en.wikipedia.org/wiki/Allometry">allometric scaling</a>, where one body measure changes (or grows) disproportionately with respect to another. Here, two of the variables are in linear units (total and forewing length), one is in squared units (forewing area) and one in cubic units (body weight, which is approximately volume). That these measures are in different units itself guarantees that they will scale allometrically with respect to each other.</p>
<p>The relationships between these variables can be described using a power law:</p>
<p><span class="math display">y = ax^b</span></p>
<p>Fortunately, if we log transform this equation, we get <span class="math inline">\log(y) = \log(a) + b \log(x)</span>. This is the equation of a straight line (<span class="math inline">y=a+bx</span>), so we should be able to make these plots straighter by logging both axes. We can create a new logged variable in the data frame like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a>genome<span class="sc">$</span>logGS <span class="ot">&lt;-</span> <span class="fu">log</span>(genome<span class="sc">$</span>GenomeSize)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br> <span class="math inline">\star</span> Using this command as a template, create a new logged version of the five variables listed above:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>genome<span class="sc">$</span>logGS <span class="ot">&lt;-</span> <span class="fu">log</span>(genome<span class="sc">$</span>GenomeSize)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a>genome<span class="sc">$</span>logBW <span class="ot">&lt;-</span> <span class="fu">log</span>(genome<span class="sc">$</span>BodyWeight)</span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>genome<span class="sc">$</span>logTL <span class="ot">&lt;-</span> <span class="fu">log</span>(genome<span class="sc">$</span>TotalLength)</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>genome<span class="sc">$</span>logFL <span class="ot">&lt;-</span> <span class="fu">log</span>(genome<span class="sc">$</span>ForewingLength)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>genome<span class="sc">$</span>logFA <span class="ot">&lt;-</span> <span class="fu">log</span>(genome<span class="sc">$</span>ForewingArea)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br> <span class="math inline">\star</span> Then, using <code>str</code>, work out which column numbers the logged variables are and create a new variable called <code>logmorpho</code> containing these numbers:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(genome)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   100 obs. of  21 variables:
 $ Suborder      : Factor w/ 2 levels "Anisoptera","Zygoptera": 1 1 1 1 1 1 1 1 1 1 ...
 $ Family        : Factor w/ 9 levels "Aeshnidae","Calopterygidae",..: 1 1 1 1 1 1 1 1 1 1 ...
 $ Species       : Factor w/ 100 levels "Aeshna canadensis",..: 1 2 3 4 5 6 8 17 46 53 ...
 $ GenomeSize    : num  2.2 1.76 1.85 1.78 2 1.59 1.44 1.16 1.44 1.2 ...
 $ GenomeSE      : num  NA 0.06 NA 0.1 NA NA NA NA NA NA ...
 $ GenomeN       : int  1 4 1 2 1 1 1 1 1 1 ...
 $ BodyWeight    : num  0.159 0.228 0.312 0.218 0.207 0.22 0.344 0.128 0.392 0.029 ...
 $ TotalLength   : num  67.6 72 78.8 72.4 73 ...
 $ HeadLength    : num  6.83 6.84 6.27 6.62 4.92 6.48 7.53 5.74 8.05 5.28 ...
 $ ThoraxLength  : num  11.8 10.7 16.2 12.5 11.1 ...
 $ AdbdomenLength: num  48.9 54.4 56.3 53.3 57 ...
 $ ForewingLength: num  45.5 46 51.2 49.8 46.5 ...
 $ HindwingLength: num  45.4 45.5 49.5 48.8 46 ...
 $ ForewingArea  : num  370 411 461 469 382 ...
 $ HindwingArea  : num  484 517 574 591 481 ...
 $ MorphologyN   : int  2 3 1 2 1 1 4 1 1 1 ...
 $ logGS         : num  0.788 0.565 0.615 0.577 0.693 ...
 $ logBW         : num  -1.84 -1.48 -1.16 -1.52 -1.58 ...
 $ logTL         : num  4.21 4.28 4.37 4.28 4.29 ...
 $ logFL         : num  3.82 3.83 3.94 3.91 3.84 ...
 $ logFA         : num  5.91 6.02 6.13 6.15 5.95 ...</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>logmorpho <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">17</span>,<span class="dv">18</span>,<span class="dv">19</span>,<span class="dv">20</span>,<span class="dv">21</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br> We can now use the <code>pairs</code> and <code>cor</code> test as before for the columns in <code>logmorpho</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(genome[, logmorpho], <span class="at">col=</span>genome<span class="sc">$</span>Suborder)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_mod_activity_files/figure-html/unnamed-chunk-16-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">cor</span>(genome[, logmorpho], <span class="at">use=</span><span class="st">'pairwise'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           logGS      logBW     logTL     logFL      logFA
logGS 1.00000000 0.08406293 0.2224443 0.1150025 0.06808306
logBW 0.08406293 1.00000000 0.8891899 0.9456492 0.94995683
logTL 0.22244431 0.88918989 1.0000000 0.9157695 0.86207098
logFL 0.11500250 0.94564919 0.9157695 1.0000000 0.97916470
logFA 0.06808306 0.94995683 0.8620710 0.9791647 1.00000000</code></pre>
</div>
</div>
<p><br> The scatterplots show that logging the data has very successfully addressed curvature (non-linearity) due to allometric scaling between variables in the data.</p>
</section>
<section id="performing-the-regression-analysis" class="level2">
<h2 class="anchored" data-anchor-id="performing-the-regression-analysis">Performing the Regression analysis</h2>
<p>We’ll now look at fitting the first linear model of this course, to explore whether log genome size explains log body weight. The first thing to do is to plot the data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>myColours <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'red'</span>, <span class="st">'blue'</span>) <span class="co"># Choose two colours</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>mySymbols <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">3</span>) <span class="co"># And two different markers</span></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">colnames</span>(genome)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Suborder"       "Family"         "Species"        "GenomeSize"    
 [5] "GenomeSE"       "GenomeN"        "BodyWeight"     "TotalLength"   
 [9] "HeadLength"     "ThoraxLength"   "AdbdomenLength" "ForewingLength"
[13] "HindwingLength" "ForewingArea"   "HindwingArea"   "MorphologyN"   
[17] "logGS"          "logBW"          "logTL"          "logFL"         
[21] "logFA"         </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(repr); <span class="fu">options</span>(<span class="at">repr.plot.res =</span> <span class="dv">100</span>, <span class="at">repr.plot.width =</span> <span class="dv">6</span>, <span class="at">repr.plot.height =</span> <span class="dv">6</span>) <span class="co"># change plot size</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(logBW <span class="sc">~</span> GenomeSize , <span class="at">data =</span> genome, <span class="co">#Now plot again</span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a><span class="at">col =</span> myColours[Suborder], <span class="at">pch =</span> mySymbols[Suborder],</span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="at">xlab=</span><span class="st">'Genome size (pg)'</span>, <span class="at">ylab=</span><span class="st">'log(Body weight) (mg)'</span>)</span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">"topleft"</span>, <span class="at">legend=</span><span class="fu">levels</span>(genome<span class="sc">$</span>Suborder), <span class="co">#Add legend at top left corner</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a>       <span class="at">col=</span> myColours, <span class="at">pch =</span> mySymbols)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_mod_activity_files/figure-html/unnamed-chunk-20-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br> It is clear that the two suborders have very different relationships: to begin with we will look at dragonflies (Anisoptera). We will calculate two linear models:</p>
<ul>
<li><p><strong>The Null Model</strong>: This is the simplest linear model: nothing is going on and the response variable just has variation around the mean: <span class="math inline">y = \beta_1</span>. This is written as an R formula as <code>y ~ 1</code>.</p></li>
<li><p><strong>The Linear (Regression) Model</strong>: This models a straight line relationship between the response variable and a continuous explanatory variable: <span class="math inline">y= \beta_1 + \beta_{2}x</span>.</p></li>
</ul>
<p>The code below fits these two models.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>nullModelDragon       <span class="ot">&lt;-</span> <span class="fu">lm</span>(logBW <span class="sc">~</span> <span class="dv">1</span>, <span class="at">data =</span> genome, <span class="at">subset =</span> Suborder <span class="sc">==</span>  <span class="st">"Anisoptera"</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>genomeSizeModelDragon <span class="ot">&lt;-</span> <span class="fu">lm</span>(logBW <span class="sc">~</span> logGS, <span class="at">data =</span> genome, <span class="at">subset =</span>  Suborder <span class="sc">==</span> <span class="st">"Anisoptera"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br> - Note the long names for the models. Short names are easier to type but calling R objects names like <code>mod1</code>, <code>mod2</code>, <code>xxx</code> swiftly get confusing!*</p>
<p><span class="math inline">\star</span> Add these model fitting commands into your script and run them.</p>
<p>Now we want to look at the output of the model. Remember from the lecture that a model has <em>coefficients</em> (the <span class="math inline">\beta</span> values in the equation of the model) and <em>terms</em> which are the explanatory variables in the model. We’ll look at the <em>coefficients</em> first:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(genomeSizeModelDragon) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = logBW ~ logGS, data = genome, subset = Suborder == 
    "Anisoptera")

Residuals:
    Min      1Q  Median      3Q     Max 
-1.3243 -0.6124  0.0970  0.5194  1.3236 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept) -2.39947    0.09085 -26.413  &lt; 2e-16 ***
logGS        1.00522    0.23975   4.193 9.54e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.6966 on 58 degrees of freedom
  (2 observations deleted due to missingness)
Multiple R-squared:  0.2326,    Adjusted R-squared:  0.2194 
F-statistic: 17.58 on 1 and 58 DF,  p-value: 9.539e-05</code></pre>
</div>
</div>
<p><br> There is a lot of information there: the model description (‘<code>Call</code>’), a summary of the residuals, a table of coefficients and then information on residual standard error, r squared and an <span class="math inline">F</span> test.</p>
<p>All of these will become clearer during this course (in particular, the meaning of Adjusted R-square will be explained in the ANOVA section — for the moment, concentrate on the coefficients table.</p>
<p>There are two rows in the coefficient table, one for each coefficient in <span class="math inline">y=\beta_1 + \beta_2x</span> — these are the intercept and the slope of the line. The rest the details on each row are a <span class="math inline">t</span> test of whether the slope and intercept are significantly different from zero.</p>
<p>The (least-squares) estimate of the slope coefficient (<code>logGS</code>) is equal to the correlation coefficient between the dependent variable (<span class="math inline">y</span>, here <code>logBW</code>) and the independent variable (<span class="math inline">x</span>, here <code>logGS</code>) times the ratio of the (sample) standard deviations of the two (see <a href="#Correlations">above</a> for the definitions of these):</p>
<p><span class="math display"> \text{Slope} = \beta_2 = r_{xy} \frac{s_y}{s_x}</span></p>
<p>Thus you can see that the regression slope is proportional to the correlation coefficient; the ratio of standard deviations serves to scale the correlation coefficient (which is unit-less) appropriately to the actual units in which the variables are measured.</p>
<p>The (least-squares) estimate of the intercept is the mean of the dependent variable minus the estimated slope coefficient times the mean of the independent variable:</p>
<p><span class="math display"> \text{Intercept} = \beta_1 = \bar{y} - \beta_2 \bar{x}  </span></p>
<p>The standard error of the model (“Residual standard error” in the output above, also referred to as the standard error of the regression) is equal to the square root of the sum of the squared residuals divided by <span class="math inline">n-2</span>. The sum of squared residuals is divided by <span class="math inline">n-2</span> in this calculation rather than <span class="math inline">n-1</span> because an additional degree of freedom for error has been used up by estimating two parameters (a slope and an intercept) rather than only one (the mean) in fitting the model to the data.</p>
<p>As you can see in the output above, each of the two model parameters, the slope and intercept, has its own standard error, and quantifies the uncertainty in these two estimates. These can be used to construct the Confidence Intervals around these estimates, which we will learn about later.</p>
<p>The main take-away from all this is that the standard errors of the coefficients are directly proportional to the standard error of the regression and inversely proportional to the square root of the sample size (<span class="math inline">n</span>). Thus, that “noise” in the data (measured by the residual standard error) affects the errors in the coefficient estimates in exactly the same way. Thus, 4 times as much data will tend to reduce the standard errors of the all coefficients by approximately a factor of 2.</p>
<p>Now we will look at the <em>terms</em> of the model using the <code>anova</code> function. We will have a proper look at ANOVA (Analysis of Variance) later.</p>
<p>Meanwhile, recall from your lecture that ANOVA tests how much variation in the response variable is explained by each explanatory variable. We only have one variable and so there is only one row in the output:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(genomeSizeModelDragon)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: logBW
          Df  Sum Sq Mean Sq F value    Pr(&gt;F)    
logGS      1  8.5294  8.5294  17.579 9.539e-05 ***
Residuals 58 28.1417  0.4852                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p><br> This table is comparing the variation in log body weight explained by log genome size to the total variation in log body weight. We are interested in how much smaller the residuals are for the genome size model than the null model. Graphically, how much shorter are the red residuals than the blue residuals:</p>
<hr>
<p><img src="regResid.png" width="500px"></p>
<p><small><br></small></p><small>
<center>
Comparison of the null and the regression models.
</center>
</small><p><small></small></p>
<hr>
<p>We can get the sums of the squares of these residuals from the two models using the function <code>resid</code>, and then square them and add them up:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">resid</span>(nullModelDragon) <span class="sc">^</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 36.67107</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sum</span>(<span class="fu">resid</span>(genomeSizeModelDragon) <span class="sc">^</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 28.14168</code></pre>
</div>
</div>
<p><br> So we have five columns in the ANOVA table:</p>
<ul>
<li><p><strong><code>Df</code></strong>: This shows the degrees of freedom. Each fitted parameter/coefficient takes up a degree of freedom from the total sample size, and the left over are the residuals degree of freedom. In this case, genome size adds a slope (compare the null model <span class="math inline">y=\beta_1</span> and this model <span class="math inline">y=\beta_1 + \beta_2x</span> — there is one more <span class="math inline">\beta</span>).</p></li>
<li><p><strong><code>Sum Sq</code></strong>: This shows sums of squares. The bottom line is the residual sum of squares for the model and the one above is the variation explained by genome size. Using the two values from above, the sums of square residuals for the null model are 36.67. In the genome size model, the sum of square residuals are 28.14 and so <span class="math inline">36.67-28.14=8.53</span> units of variance have been explained by this model.</p></li>
<li><p><strong><code>Mean Sq</code></strong>: These are just the Sum Sq (Sum of Squares) values divided by the degrees of freedom. The idea behind this is simple: if we explain lots of variation with one coefficient, that is good (the null model), and if we explain a small amount of variation with a loss of degree of freedom (by adding and then estimating more parameters), then that is bad.</p></li>
<li><p><strong><code>F value</code></strong>: This is the ratio of the Mean Sq for the variable and the residual Mean Sq. This is used to test whether the explained variation is large or small.</p></li>
<li><p><strong><code>Pr(&gt;F)</code></strong>: This is the <span class="math inline">p</span> value — the probability of the x-variable (the fitted model) explaining this much variance by chance.</p></li>
</ul>
<p>In this case, it is clear that genome size explains a significant variation in body weight.</p>
<p><span class="math inline">\star</span> Include the <code>summary</code> and <code>anova</code> commands for <code>genomeSizeModelDragon</code> in your script, run them and check you are happy with the output.</p>
<section id="exercise" class="level3">
<h3 class="anchored" data-anchor-id="exercise">Exercise</h3>
<p>Using the above code as a template, create a new model called <code>genomeSizeModelDamsel</code> that fits log body weight as a function of log genome size for damselflies. Write and run code to get the <code>summary</code> and <code>anova</code> tables for this new model. For example, the first step would be:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>genomeSizeModelDamsel <span class="ot">&lt;-</span> <span class="fu">lm</span>(logBW <span class="sc">~</span> logGS, <span class="at">data=</span>genome,<span class="at">subset=</span>Suborder<span class="sc">==</span><span class="st">'Zygoptera'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="plotting-the-fitted-regression-model" class="level3">
<h3 class="anchored" data-anchor-id="plotting-the-fitted-regression-model">Plotting the fitted Regression model</h3>
<p>Now we can plot the data and add lines to show the models. For simple regression models, we can use the function <code>abline(modelName)</code> to add a line based on the model.</p>
<p><span class="math inline">\star</span> Create a scatterplot of log body weight as a function of log genome size, picking your favourite colours for the points.</p>
<p>Use <code>abline</code> to add a line for each model and use the <code>col</code> option in the function to colour each line to match the points.</p>
<p>For example: <code>abline(genomeSizeModelDragon, col='red')</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>myCol <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">'red'</span>,<span class="st">'blue'</span>)</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(repr); <span class="fu">options</span>(<span class="at">repr.plot.res =</span> <span class="dv">100</span>, <span class="at">repr.plot.width =</span> <span class="dv">8</span>, <span class="at">repr.plot.height =</span> <span class="dv">8</span>) <span class="co"># change plot size</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(logBW <span class="sc">~</span> logGS, <span class="at">data=</span>genome, <span class="at">col=</span>myCol[Suborder], <span class="at">xlab=</span><span class="st">'log Genome Size (pg)'</span>, <span class="at">ylab=</span><span class="st">'log Body Weight (g)'</span>)</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(genomeSizeModelDragon, <span class="at">col=</span><span class="st">'red'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_mod_activity_files/figure-html/unnamed-chunk-27-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br> Your final figure should look something like this:</p>
<p><img src="GenoRegModels.png" width="400px"></p>
<p><small></small></p><small>
<center>
Linear regression models fitted to the body weight vs.&nbsp;genome size to the Dragonfly (red) and Damselfly (blue) subsets of the data.
</center>
</small><p><small></small></p>
</section>
</section>
<section id="model-diagnostics" class="level2">
<h2 class="anchored" data-anchor-id="model-diagnostics">Model diagnostics</h2>
<p>Now that we have our models, we need to check that they are appropriate for the data. For this, we will inspect “diagnostic plots”. Producing diagnostic plots is easy in R — if you <code>plot</code> the model object, then R produces a set of diagnostic plots!</p>
<p><span class="math inline">\star</span> Quick note on <a href="https://www.rdocumentation.org/packages/graphics/versions/3.6.2/topics/par">par</a>: this is used to tell R where you want your plots when you build.</p>
<p><span class="math inline">\star</span> Try the following code (and include in the R script file):</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">5</span>, <span class="fl">1.5</span>, <span class="fl">1.5</span>))</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(genomeSizeModelDragon)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_mod_activity_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br> These are the diagnostics for the <code>lm</code> fit to the Dragonfly data subset.</p>
<p>Let’s also plot the diagnostic pots for the model fitted to the Damselfly subset:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow =</span> <span class="fu">c</span>(<span class="dv">2</span>, <span class="dv">2</span>), <span class="at">mar =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="dv">5</span>, <span class="fl">1.5</span>, <span class="fl">1.5</span>))</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(genomeSizeModelDamsel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_mod_activity_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br> The diagnostic plots are:</p>
<ul>
<li><p><strong>Residuals vs Fitted</strong>: This plot is used to spot if the distribution of the residuals (the vertical distance from a point to the regression line) has <em>similar variance</em> for different predicted values (the y-value on the line corresponding to each x-value). There should be no obvious patterns (such as curves) or big gaps. If there was no scatter, if all the points fell exactly on the line, then all of the dots on this plot would lie on the gray horizontal dashed line. The red line is a smoothed curve to make it easier to see trends in the residuals. It is flat in the Dragonfly model fit above, and a bit more wavy than we would like in the in the Damselfly model fit, but there are no clear trends in either, which is what you hope to see.</p></li>
<li><p><strong>Normal Q–Q</strong>: This plot is to check whether the residuals are <em>normally distributed</em> — are the values of the observed residuals similar to those expected under a normal distribution? Ideally, the points should form a perfectly straight line, indicating that the observed residuals exactly match the expected. Here, note that the points lie pretty close to the dashed line in both sets of diagnostic Figures above, but deviate at the ends, especially for Damselflies. However, some deviation is to be expected near the ends — here these deviations are just about acceptable.</p></li>
<li><p><strong>Scale–Location</strong>: The x-axis on this plot is identical to the Residuals vs Fitted plot – these are the fitted values. The y-axis is the square root of the <em>standardized residuals</em>, which are residuals rescaled so that they have a mean of zero and a variance of one. As a result, all y-axis values are positive. Thus large residuals (both positive and negative) plot at the top, and small residuals plot at the bottom (so only their <em>scale</em> is retained). Thus, all of the numbered points (which will be the same in all plots) plot at the top here. The red line here shows the trend, just like the Residuals vs Fitted plot. The regression analysis has assumed homoscedasticity, that the variance in the residuals doesn’t change as a function of the predictor. If that assumption is correct, the red line should be relatively flat. It is not quite as flat as we would like, especially for the Dragonfly analysis.</p></li>
<li><p><strong>Residuals vs Leverage</strong>: This plot shows the standardized residuals against leverage. “Leverage” is a measure of how much each data point influences the linear model’s coefficient estimates. Because the regression line must pass through the centroid (“pivot point”) of the data, points that lie far from the centroid have greater leverage, and their leverage increases if there are fewer points nearby. Here is an illustration:</p></li>
</ul>
<hr>
<p><img src="Leverage.png" width="350px"></p>
<p><small></small></p><small>
<center>
Leverage of data points on slope of a regression. The points further away from the centroid in the x-axis direction have more leverage, and can therefore move the regression line up or down (dashed red lines)
</center>
</small><p><small></small></p>
<p>There are two key things to note about this plot:</p>
<ol type="1">
<li><p>The standardized residuals (y-axis) are centered around zero and reach 2-3 standard deviations away from zero. They should also lie symmetrically about zero, as would be expected for a normal distribution. This is the case for the Damselfly plot , but not so much for the Dragonfly plot.</p></li>
<li><p>The contours values show <em>Cook’s distance</em> (only visible in the Damsefly plot), which measures how much the regression would change if a point was deleted. Cook’s distance is increased by leverage and by large residuals: a point far from the centroid with a large residual can severely distort the coefficient estimates from the regression. On this plot, you want to see that the red smoothed line stays close to the horizontal gray dashed line and that no points have a large Cook’s distance (i.e, &gt;0.5). Both are true here.</p></li>
</ol>
<p>This is an important diagnostic plot in regression analyses in particular because it tells you whether your estimate of the slope coefficient in particular is strongly affected by certain data points.</p>
<p>Note that certain points are numbered in all the diagnostic plots — these are points to pay special attention to because they are <em>potential</em> outliers. The numbers correspond to the row number for that dataset in your data frame. You can easily identify these points in your data plot because the order of the points along the fitted values axis (y-axis) in the diagnostic plot matches the order along the x-axis in the data plot. So, for example here, in the dragonfly diagnostic plots the two numbered points (46, 10) near the bottom correspond in the data plot to the two red points near the center-left that lie farthest below the red line (see the plot with regression lines fitted to the data).</p>
<p>Thus, neither the Drangonfly nor the Damselfly diagnostic plots look perfect, but this level of deviation from assumptions of linear models is acceptable. The main worrying factors are that the Q-Q plot for Damselflies indicates the observed residuals are a bit more extreme than expected, and the Scale–Location plot for Dragonflies suggests some pattern in the standardized residuals wrt location of the fitted values.</p>
<p><span class="math inline">\star</span> Copy the code to create the diagnostic plots into your script to keep a record of the code and run it.</p>
</section>
<section id="reporting-the-model" class="level2">
<h2 class="anchored" data-anchor-id="reporting-the-model">Reporting the model</h2>
<p>Now we know that the models are appropriate and we have a plot, the last thing is to report the statistics. For the damselfly model, here is one summary that would do: log genome size explains significant variation in log body weight in dameselflies (F=10.5, df=1,36, p=0.0025) and shows that body weight decreases with genome size (intercept: -4.65, se=0.09; slope: -1.14, se=0.35).</p>
</section>
</section>
<section id="linear-models-analysis-of-variance" class="level1">
<h1>Linear Models: Analysis of variance</h1>
<section id="introduction-1" class="level2">
<h2 class="anchored" data-anchor-id="introduction-1">Introduction</h2>
<p>Analysis of Variance, is very often a good choice if your response (dependent) variable is continuous, and your predictor (independent) variables is categorical.</p>
<p>In this section, you will learn to perform an ANOVA, that is, fit this linear model to the data. Specifically, you will learn to<a href="#fn1"><span class="math inline">^{[1]}</span></a>:</p>
<ul>
<li><p>Visualize the data by plotting boxplots and barplots</p></li>
<li><p>Fit an ANOVA to test whether certain factors can explain (partition) the variation in your data</p></li>
<li><p>Perform diagnostics to determine whether the factors are explanatory, and whether the Linear Model is appropriate for your data</p></li>
<li><p>Explore and compare how much the different levels of a factor explain the variation in your data</p></li>
</ul>
</section>
<section id="what-is-anova" class="level2">
<h2 class="anchored" data-anchor-id="what-is-anova">What is ANOVA?</h2>
<p><u>An</u>alysis <u>O</u>f <u>Va</u>riance (ANOVA) is an extremely useful class of Linear models. It is very often appropriate when your response (dependent) variable is continuous, while your predictor (independent) variable is categorical. Specifically, <em>One-way ANOVA</em> is used to compare means of two or more samples representing numerical, continuous data in response to a single categorical variable (factor).</p>
<p><img src="ANOVA_is_LM.png" alt="ANOVA example" width="300px"></p>
<p><small></small></p><small>
<center>
A dataset where an ANOVA is appropriate. <br> Performing an ANOVA on this dataset is the same as fitting the linear model <span class="math inline">y = \beta_1 + \beta_2 x_s + \beta_3 x_a</span>, where <span class="math inline">x_s</span> and <span class="math inline">x_a</span> are two levels (“treatments”, representing statistically separate populations) within the factor (games console ownership). Here, the first treatment, the control, is captured by the baseline value <span class="math inline">\beta_1</span> (the sample with the lowest value, on the far left).
</center>
</small><p><small></small></p>
<p>(One-way) ANOVA tests the null hypothesis that samples from two or more groups (the treatments or factors) are drawn from populations with the <em>same mean value</em>. That is, the null hypothesis is that all the groups are random samples from the <em>same</em> population (no statistical difference in their means). To do this,&nbsp;ANOVA compares&nbsp;the&nbsp;variance in the data explained by fitting the linear model, to the unexplained variance (the null hypothesis.</p>
<p>In other words, in effect, ANOVA asks whether a linear model with a predictor (or explanatory variable) with at least two categorical levels (or factors), better accounts for the variance (Explained Sum of Squares, ESS, see below) than a null model of the form <span class="math inline">y = \beta_1</span>. Thus, ANOVA is just a type of linear model.</p>
<p>By the end of this section, it will also make more sense to you how/why fitting a linear regression model to the data of the form <span class="math inline">y = \beta_1 + \beta_2 x</span> (where <span class="math inline">x</span> is a continuous predictor variable), requires an ANOVA to determine if the model better fits than a null model of the form <span class="math inline">y = \beta_1</span>.</p>
<p>Typically, one-way ANOVA is used to test for differences among at least three groups, since the two-group (or levels or factors) case can be covered by a <span class="math inline">t</span>-test. When there are only two means to compare, the <span class="math inline">t</span>-test and the F-test are equivalent; the relation between ANOVA and t is given by <span class="math inline">F = t^2</span>.</p>
<p>An extension of one-way ANOVA is two-way analysis of variance that examines the influence of two different categorical independent variables on one dependent variable. We will explore multiple predictors in later segments.</p>
</section>
<section id="calculating-the-anova-test-statistic" class="level2">
<h2 class="anchored" data-anchor-id="calculating-the-anova-test-statistic">Calculating the ANOVA test statistic</h2>
<p>ANOVA uses the <a href="https://blog.minitab.com/en/adventures-in-statistics-2/understanding-analysis-of-variance-anova-and-the-f-test#:~:text=The%20F%2Dstatistic%20is%20the,F%2Dstatistic%20of%20approximately%201.&amp;text=In%20order%20to%20reject%20the,need%20a%20high%20F%2Dvalue.">F-Statistic</a>. To this end, an ANOVA “partitions” variability in your data as follows:</p>
<p><strong>Total sum of squares (TSS)</strong>: This is the sum of the squared difference between the observed dependent variable (<span class="math inline">y</span>) and the mean of the response variable <span class="math inline">y</span> (denoted by <span class="math inline">\bar{y}</span>), i.e.,</p>
<p><span class="math display">\text{TSS} = \sum_{i=1}^{n}(y_i - \bar{y})^2</span></p>
<p>TSS tells us how much variation there is in the dependent variable without having any other information (your null model). You might notice that TSS is the numerator of the <em>sample variance</em> (or it’s square-root, the <em>sample standard deviation</em>).</p>
<p><strong>Explained sum of squares (ESS)</strong>: Sum of the squared differences between the predicted <span class="math inline">y</span>’s (denoted <span class="math inline">\hat{y}</span>’s) and <span class="math inline">\bar{y}</span>, or, <span class="math display">\text{ESS} = \sum_{i=1}^{n} (\hat{y}_i - \bar{y})^2</span> ESS tells us how much of the variation in the dependent variable our alternative (linear) model was able to explain. That is, it’s the reduction in uncertainty that occurs when the linear model is used to predict the responses.</p>
<p><strong>Residual sum of squares (RSS)</strong>: Sum of the squared differences between the observed <span class="math inline">y</span>’s (denoted by <span class="math inline">y_i</span>) and the predicted <span class="math inline">\hat{y}</span>, or, <span class="math display">\text{RSS} = \sum_{i=1}^{n} (\hat{y}_i - y_i)^2</span> RSS tells us how much of the variation in the dependent variable our model could not explain. That is, it’s the uncertainty that remains even after the linear model is used. The linear model is considered to be statistically significant if it can account for a large amount of variability in the response.</p>
<ul>
<li>And of course, TSS = ESS + RSS. That is, the OLS method “decomposes” the total variation in the dependent variable into an explained component (ESS; explained by the predictor) and an unexplained or residual component (the RSS).</li>
</ul>
<p>The sums of squares used to calculate the statistical significance of the linear model (Regression, ANOVA, etc) through the F value are as follows:</p>
<table class="table">
<colgroup>
<col style="width: 23%">
<col style="width: 34%">
<col style="width: 20%">
<col style="width: 21%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;">Type of Sum of Squares (SS)</th>
<th style="text-align: center;">SS Calculation</th>
<th style="text-align: center;">Degrees of Freedom (DF)</th>
<th style="text-align: center;">Mean Sum of Squares (MSS)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">TSS</td>
<td style="text-align: center;"><span class="math inline">\sum_{i=1}^{n}(y_i - \bar{y})^2</span></td>
<td style="text-align: center;"><span class="math inline">n-1</span></td>
<td style="text-align: center;"><span class="math inline">\frac{TSS}{n-1}</span></td>
</tr>
<tr class="even">
<td style="text-align: left;">ESS</td>
<td style="text-align: center;"><span class="math inline">\sum_{i=1}^{n} (\hat{y}_i - \bar{y})^2</span></td>
<td style="text-align: center;"><span class="math inline">n_c-1</span></td>
<td style="text-align: center;"><span class="math inline">\frac{ESS}{n_c-1}</span></td>
</tr>
<tr class="odd">
<td style="text-align: left;">RSS</td>
<td style="text-align: center;"><span class="math inline">\sum_{i=1}^{n} (\hat{y}_i - y_i)^2</span></td>
<td style="text-align: center;"><span class="math inline">n-n_c</span></td>
<td style="text-align: center;"><span class="math inline">\frac{RSS}{n-n_c}</span></td>
</tr>
</tbody>
</table>
<p>Let’s try to make sense of these calculations. Firstly, because we are dealing with samples understanding the degrees of freedom is critical.</p>
<section id="degrees-of-freedom" class="level3">
<h3 class="anchored" data-anchor-id="degrees-of-freedom">Degrees of freedom</h3>
<p>Each sum of squares has a corresponding degrees of freedom (DF) associated with it that gives the Mean Sum of Squares (MSS) — the Sums of Squares divided by the corresponding degrees of freedom.</p>
<ul>
<li><p>The TSS DF is one less than the number of observations <span class="math inline">n-1</span>. This is because calculating TSS, needs <span class="math inline">\bar y</span> , which imposes loss of one degree of freedom. Note that MSS is thus nothing but the sample variance.</p></li>
<li><p>The ESS DF is one less than the number of coefficients (<span class="math inline">n_c</span>) (estimated parameters) in the model: <span class="math inline">n_c-1</span>. Note that in the case where the linear model is an ANOVA, the number of coefficients equals the number of “treatments” (the categories or levels in the predictor or factor). So for example, in <a href="#fig:anova1">Figure 1</a>, there are three treatments (predictors) and therefore three coefficients (<span class="math inline">\beta_1</span>, <span class="math inline">\beta_2</span>, <span class="math inline">\beta_3</span>), which means that the ESS degrees of freedom there is <span class="math inline">n_c-1 = 2</span>.</p></li>
<li><p>The RSS DF is the sample size <span class="math inline">n</span> minus the number of coefficients that you need to estimate (<span class="math inline">n_c</span>), that is, <span class="math inline">n - n_c</span>, because each estimated coefficient is an unknown parameter.</p></li>
</ul>
</section>
<section id="the-f-value-or-ratio" class="level3">
<h3 class="anchored" data-anchor-id="the-f-value-or-ratio">The F-Value (or Ratio)</h3>
<p>The F-Value or F-Ratio, the test statistic used to decide whether the linear model fit is statistically significant, is the ratio of the Mean ESS to the Mean RSS:</p>
<p><span class="math display">
F = \frac{\left(\frac{ESS}{n_c-1}\right)}{\left(\frac{RSS}{n-n_c}\right)}
</span></p>
<p>If the null hypothesis that the group means are drawn from sub-populations with the <em>same</em> mean were indeed true, the between-group variance (numerator in this F-ratio) should be lower than the within-group variance (denominator). The null hypothesis is rejected if this F-Ratio is large — the model explains a significant amount of variance, and we can conclude that the samples were drawn from populations with different mean values.</p>
<p>The p-value is calculated for the overall model fit using the F-distribution.</p>
<p>Also note that the Root Mean Square Error (RMSE), also known as the standard error of the estimate, is the square root of the Mean RSS. It is the standard deviation of the data about the Linear model, rather than about the sample mean.</p>
</section>
<section id="the-r2" class="level3">
<h3 class="anchored" data-anchor-id="the-r2">The <span class="math inline">R^{2}</span></h3>
<p>The <span class="math inline">R^{2}</span>, also called the Coefficient of Determination, is the proportion of total error (TSS) explained by the model (ESS), so the ratio ESS/TSS. That is it is the proportion of the variability in the response that is explained by the fitted model. Since TSS = ESS + RSS, <span class="math inline">R^{2}</span> can be rewritten as (TSS-RSS)/TSS = 1 - RSS/TSS. If a model perfectly fits the data, <span class="math inline">R^{2}=1</span>, and if it has no predictive capability <span class="math inline">R^{2}=0</span>. In reality, <span class="math inline">R^{2}</span> will never be exactly 0 because even a null model will explain some variance just by chance due to sampling error. Note that <span class="math inline">R</span>, the square root of <span class="math inline">R^2</span>, is the multiple correlation coefficient: the correlation between the observed values (<span class="math inline">y</span>), and the predicted values (<span class="math inline">\hat{y}</span>).</p>
<section id="adjusted-r2" class="level4">
<h4 class="anchored" data-anchor-id="adjusted-r2">Adjusted <span class="math inline">R^{2}</span></h4>
<p>As additional predictors (and therefore linear model coefficients) are added to a linear model, <span class="math inline">R^2</span> increases even when the new predictors add no real predictive capability. The adjusted-<span class="math inline">R^2</span> tries to address this problem of over-specification or over-fitting by including the degrees of freedom: Adjusted <span class="math inline">R^2</span> = 1 - (RSS/<span class="math inline">n-n_c-2</span>)/(TSS/<span class="math inline">n-1</span>) <a href="#fn2"><span class="math inline">^{[2]}</span></a>.</p>
<p>Thus, additional predictors with little explanatory capability will increase the ESS (and reduce the RSS), but they will also have lower RSS degrees of freedom (because of the additional number of fitted coefficients, <span class="math inline">n_c</span>’s)<a href="#fn3"><span class="math inline">^{[3]}</span></a>. Thus if the additional predictors have poor predictive capability, these two reductions will cancel each other out. In other words, the Adjusted <span class="math inline">R^2</span> penalizes the addition of new predictors to the linear model, so you should always have a look at the Adjusted <span class="math inline">R^2</span> as a corrected measure of <span class="math inline">R^2</span>.</p>
</section>
</section>
</section>
<section id="an-example-anova" class="level2">
<h2 class="anchored" data-anchor-id="an-example-anova">An example ANOVA</h2>
<p>In this section, we will use a dataset from a recent paper on the effects of temperature and larval resource supply on <em>Aedes aegypti</em> life history traits and the vector’s maximal population growth rate (<a href="https://royalsocietypublishing.org/doi/10.1098/rspb.2020.3217"><strong>Huxley <em>et al</em>. 2021</strong></a>).</p>
<section id="the-data" class="level3">
<h3 class="anchored" data-anchor-id="the-data">The data</h3>
<p><span class="math inline">\star</span> Download the file <code>traitdata_Huxleyetal_2021.csv</code> and save to your <code>Data</code> directory.</p>
<p><span class="math inline">\star</span> Create a new blank script called <code>ANOVA_Prac.R</code> and add some introductory comments.</p>
<p><span class="math inline">\star</span> Use <code>read.csv</code> to load the data in the data frame <code>mozwing</code> and then <code>str</code> and <code>summary</code> to examine the data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">'tidyverse'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: tidyverse</code></pre>
</div>
<div class="cell-output cell-output-stderr">
<pre><code>── Attaching core tidyverse packages ──────────────────────── tidyverse 2.0.0 ──
✔ dplyr     1.1.4     ✔ readr     2.1.5
✔ forcats   1.0.0     ✔ stringr   1.5.1
✔ ggplot2   3.5.0     ✔ tibble    3.2.1
✔ lubridate 1.9.3     ✔ tidyr     1.3.1
✔ purrr     1.0.2     
── Conflicts ────────────────────────────────────────── tidyverse_conflicts() ──
✖ dplyr::filter() masks stats::filter()
✖ dplyr::lag()    masks stats::lag()
ℹ Use the conflicted package (&lt;http://conflicted.r-lib.org/&gt;) to force all conflicts to become errors</code></pre>
</div>
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">'gplots'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Loading required package: gplots

Attaching package: 'gplots'

The following object is masked from 'package:stats':

    lowess</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="fu">require</span>(<span class="st">'repr'</span>)</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a><span class="fu">rm</span>(<span class="at">list=</span><span class="fu">ls</span>())</span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a><span class="fu">graphics.off</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>mozwing      <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">'activities/data/traitdata_Huxleyetal_2021.csv'</span>, <span class="at">stringsAsFactors =</span> T)</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>mozwing<span class="sc">$</span>temp <span class="ot">&lt;-</span> <span class="fu">as_factor</span>(mozwing<span class="sc">$</span>temp) <span class="co"># define temperature and food level as categorical</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a>mozwing<span class="sc">$</span>food_level <span class="ot">&lt;-</span> <span class="fu">as_factor</span>(mozwing<span class="sc">$</span>food_level) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(mozwing)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   270 obs. of  33 variables:
 $ ID                    : int  4 6 7 11 11 12 19 20 16 21 ...
 $ exp_no                : int  3 3 3 3 3 3 3 3 3 3 ...
 $ rep                   : Factor w/ 3 levels "A","B","C": 1 1 1 1 3 1 1 1 3 1 ...
 $ dens                  : num  0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 ...
 $ rearing_vessel        : Factor w/ 1 level "tub": 1 1 1 1 1 1 1 1 1 1 ...
 $ temp                  : Factor w/ 3 levels "22","26","32": 1 1 1 1 1 1 1 1 1 1 ...
 $ food_level            : Factor w/ 2 levels "0.1","1": 1 1 1 1 1 1 1 1 1 1 ...
 $ treatment             : Factor w/ 6 levels "22_0.1","22_1",..: 1 1 1 1 1 1 1 1 1 1 ...
 $ feeding_interval      : int  24 24 24 24 24 24 24 24 24 24 ...
 $ egg_sub               : Factor w/ 2 levels "29/03/2019 12:00",..: 1 1 1 1 1 1 1 1 1 1 ...
 $ l_emerg               : Factor w/ 2 levels "30/03/2019 12:00",..: 1 1 1 1 1 1 1 1 1 1 ...
 $ l_emerg_days_frm_sub  : int  1 1 1 1 1 1 1 1 1 1 ...
 $ l_death               : Factor w/ 29 levels "01/04/2019 12:00",..: NA NA NA NA NA NA NA NA NA NA ...
 $ l_surv                : int  0 0 0 0 0 0 0 0 0 0 ...
 $ pupal_ref             : int  1 3 4 7 2 8 12 13 6 14 ...
 $ p_emerg               : Factor w/ 27 levels "01/05/2019 12:00",..: 24 25 26 3 26 3 5 7 27 7 ...
 $ l_to_p_devtime        : int  28 29 30 34 30 34 35 36 32 36 ...
 $ l_to_p_devrate        : num  0.0357 0.0345 0.0333 0.0294 0.0333 ...
 $ p_death               : Factor w/ 8 levels "03/04/2019 12:00",..: NA NA NA NA NA NA NA NA NA NA ...
 $ p_surv                : int  0 0 0 0 0 0 0 0 0 0 ...
 $ a_emerg               : Factor w/ 30 levels "01/05/2019 12:00",..: 29 30 1 7 1 7 9 13 3 11 ...
 $ p_to_a_devtime        : int  3 3 3 3 3 3 3 4 3 3 ...
 $ p_to_a_devrate        : num  0.333 0.333 0.333 0.333 0.333 ...
 $ a_death               : Factor w/ 39 levels "01/05/2019 12:00",..: 9 5 7 15 5 15 23 12 14 21 ...
 $ adult_lifespan        : int  8 5 5 6 4 6 9 1 7 7 ...
 $ adult_mort_rate       : num  0.125 0.2 0.2 0.167 0.25 ...
 $ hatch_to_a_devtime    : int  31 32 33 37 33 37 38 40 35 39 ...
 $ hatch_to_adult_devrate: num  0.0323 0.0312 0.0303 0.027 0.0303 ...
 $ sex                   : Factor w/ 1 level "female": 1 1 1 1 1 1 1 1 1 1 ...
 $ im_surv               : int  0 0 0 0 0 0 0 0 0 0 ...
 $ j_lifetime            : int  31 32 33 37 33 37 38 40 35 39 ...
 $ total_lifespan        : int  39 37 38 43 37 43 47 41 42 46 ...
 $ length_mm             : num  2.93 2.59 2.41 2.62 2.28 2.39 2.99 2.5 2.75 2.82 ...</code></pre>
</div>
</div>
<p><br> There are 33 variables but only a subset of these are of interest to us here. Let’s summarize the data to explore further:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(mozwing)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       ID            exp_no  rep         dens     rearing_vessel temp   
 Min.   : 1.00   Min.   :3   A:87   Min.   :0.2   tub:270        22:90  
 1st Qu.: 9.00   1st Qu.:3   B:87   1st Qu.:0.2                  26:90  
 Median :17.00   Median :3   C:96   Median :0.2                  32:90  
 Mean   :16.07   Mean   :3          Mean   :0.2                         
 3rd Qu.:24.00   3rd Qu.:3          3rd Qu.:0.2                         
 Max.   :30.00   Max.   :3          Max.   :0.2                         
                                                                        
 food_level  treatment  feeding_interval             egg_sub   
 0.1:135    22_0.1:45   Min.   :24       29/03/2019 12:00:153  
 1  :135    22_1  :45   1st Qu.:24       30/03/2019 12:00:117  
            26_0.1:45   Median :24                             
            26_1  :45   Mean   :24                             
            32_0.1:45   3rd Qu.:24                             
            32_1  :45   Max.   :24                             
                                                               
             l_emerg    l_emerg_days_frm_sub             l_death   
 30/03/2019 12:00:153   Min.   :1            31/03/2019 12:00: 35  
 31/03/2019 12:00:117   1st Qu.:1            01/04/2019 12:00:  7  
                        Median :1            15/05/2019 12:00:  6  
                        Mean   :1            18/04/2019 12:00:  5  
                        3rd Qu.:1            14/04/2019 12:00:  4  
                        Max.   :1            (Other)         : 46  
                                             NA's            :167  
     l_surv         pupal_ref                 p_emerg    l_to_p_devtime
 Min.   :0.0000   Min.   : 1.00   03/04/2019 12:00: 26   Min.   : 3.0  
 1st Qu.:0.0000   1st Qu.: 6.00   04/04/2019 12:00: 22   1st Qu.: 6.0  
 Median :0.0000   Median :11.00   07/04/2019 12:00: 22   Median : 9.0  
 Mean   :0.3815   Mean   :11.65   05/04/2019 12:00: 13   Mean   :14.9  
 3rd Qu.:1.0000   3rd Qu.:17.00   06/04/2019 12:00: 10   3rd Qu.:26.0  
 Max.   :1.0000   Max.   :27.00   (Other)         : 74   Max.   :38.0  
                  NA's   :103     NA's            :103   NA's   :103   
 l_to_p_devrate                p_death        p_surv       
 Min.   :0.02632   05/04/2019 12:00:  3   Min.   :0.00000  
 1st Qu.:0.03846   08/04/2019 12:00:  2   1st Qu.:0.00000  
 Median :0.11111   03/04/2019 12:00:  1   Median :0.00000  
 Mean   :0.11582   06/04/2019 12:00:  1   Mean   :0.06587  
 3rd Qu.:0.16667   07/05/2019 12:00:  1   3rd Qu.:0.00000  
 Max.   :0.33333   (Other)         :  3   Max.   :1.00000  
 NA's   :103       NA's            :259   NA's   :103      
             a_emerg    p_to_a_devtime  p_to_a_devrate               a_death   
 05/04/2019 12:00: 20   Min.   :1.000   Min.   :0.2500   07/04/2019 12:00: 11  
 10/04/2019 12:00: 20   1st Qu.:2.000   1st Qu.:0.3333   12/04/2019 12:00: 11  
 06/04/2019 12:00: 18   Median :2.000   Median :0.5000   13/04/2019 12:00: 10  
 07/04/2019 12:00: 10   Mean   :2.436   Mean   :0.4605   02/05/2019 12:00:  9  
 09/04/2019 12:00: 10   3rd Qu.:3.000   3rd Qu.:0.5000   08/04/2019 12:00:  8  
 (Other)         : 78   Max.   :4.000   Max.   :1.0000   (Other)         :107  
 NA's            :114   NA's   :114     NA's   :114      NA's            :114  
 adult_lifespan  adult_mort_rate   hatch_to_a_devtime hatch_to_adult_devrate
 Min.   : 1.00   Min.   :0.06667   Min.   : 5.00      Min.   :0.02439       
 1st Qu.: 4.00   1st Qu.:0.11111   1st Qu.: 8.00      1st Qu.:0.03571       
 Median : 6.00   Median :0.16667   Median :12.00      Median :0.08333       
 Mean   : 6.59   Mean   :0.23194   Mean   :17.44      Mean   :0.08661       
 3rd Qu.: 9.00   3rd Qu.:0.25000   3rd Qu.:28.00      3rd Qu.:0.12500       
 Max.   :15.00   Max.   :1.00000   Max.   :41.00      Max.   :0.20000       
 NA's   :114     NA's   :114       NA's   :114        NA's   :114           
     sex         im_surv         j_lifetime    total_lifespan    length_mm    
 female:156   Min.   :0.0000   Min.   : 1.00   Min.   : 1.00   Min.   :2.030  
 NA's  :114   1st Qu.:0.0000   1st Qu.: 6.00   1st Qu.: 8.00   1st Qu.:2.510  
              Median :0.0000   Median :12.00   Median :18.00   Median :2.730  
              Mean   :0.4222   Mean   :15.97   Mean   :19.78   Mean   :2.742  
              3rd Qu.:1.0000   3rd Qu.:27.00   3rd Qu.:30.00   3rd Qu.:3.020  
              Max.   :1.0000   Max.   :47.00   Max.   :49.00   Max.   :3.270  
                                                               NA's   :121    </code></pre>
</div>
</div>
<p><br> You will see from the output of <code>summary</code> that there are data on several vector traits, such as juvenile development, adult longevity and wing length.</p>
</section>
<section id="exploring-the-data-with-boxplots" class="level3">
<h3 class="anchored" data-anchor-id="exploring-the-data-with-boxplots">Exploring the data with boxplots</h3>
<p>The body size of arthropod vectors is expected to have an important effect on vector-borne disease transmission risk, because it is associated with traits, such as longevity and biting rate. In organisms with complex life histories, including mosquitoes, adult size is strongly affected by larval rearing conditions.</p>
<p>Here, we are interested in finding out whether wing length varies predictably across temperatures (a typical one-way ANOVA question).</p>
<ul>
<li>Before we fit any models, we want to plot the data to see if the means within these groupings look different. We also want to check whether the variance looks similar for each group: <em>constant normal variance</em>! A simple way is to look at box and whisker plots, showing the median and range of the data:</li>
</ul>
<p><span class="math inline">\star</span> Generate a boxplot of the differences in wing length between temperatures:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(length_mm <span class="sc">~</span> temp, mozwing)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_mod_activity_files/figure-html/unnamed-chunk-34-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br> Looking at the plots, it is clear that there is more spread in the data below the median than above. Create a new variable <code>logwinglength</code> in the <code>mozwing</code> data frame containing logged millimeter values.</p>
<p><span class="math inline">\star</span> Now create a boxplot of log wing length values within temperatures:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>mozwing<span class="sc">$</span>loglength <span class="ot">&lt;-</span> <span class="fu">log</span>(mozwing<span class="sc">$</span>length_mm)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br> ### Differences in means with barplots</p>
<p>Box and whisker plots show the median and spread in the data very clearly, but we want to test whether the means are different. This is <span class="math inline">t</span> test territory — how different are the means given the standard error — so it is common to use barplots and standard error bars to show these differences.</p>
<p>We’re going to use some R code to construct a barplot by hand. We need to calculate the means and standard errors within temperature groups, but before we can do that, we need a new functions to calculate the standard error of a mean:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a>seMean <span class="ot">&lt;-</span> <span class="cf">function</span>(x){ <span class="co"># get standard error of the mean from a set of values (x)</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>    x  <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(x) <span class="co"># get rid of missing values</span></span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a>    se <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">var</span>(x)<span class="sc">/</span><span class="fu">length</span>(x)) <span class="co"># calculate the standard error</span></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(se)  <span class="co"># tell the function to return the standard error</span></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br> Now we can use the function <code>tapply</code>: it splits a variable up into groups from a factor and calculates statistics on each group using a function.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>lengthMeans <span class="ot">&lt;-</span> <span class="fu">tapply</span>(mozwing<span class="sc">$</span>loglength, mozwing<span class="sc">$</span>temp, <span class="at">FUN =</span> mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(lengthMeans)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>       22        26        32 
1.0737861 0.9824950 0.9131609 </code></pre>
</div>
</div>
<p><br> And similarly, let’s calculate the standard error of the mean using the function we made:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>lengthSE <span class="ot">&lt;-</span> <span class="fu">tapply</span>(mozwing<span class="sc">$</span>loglength, mozwing<span class="sc">$</span>temp, <span class="at">FUN =</span> seMean)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(lengthSE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        22         26         32 
0.01330309 0.01431165 0.01230405 </code></pre>
</div>
</div>
<p><br> Now we have to put these values together on the plot:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get the upper and lower limits of the error bars</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>upperSE <span class="ot">&lt;-</span> lengthMeans <span class="sc">+</span> lengthSE</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a>lowerSE <span class="ot">&lt;-</span> lengthMeans <span class="sc">-</span> lengthSE</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="co"># get a barplot</span></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="co"># - this function can report where the middle of the bars are on the x-axis</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="co"># - set the y axis limits to contain the error bars</span></span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a>barMids <span class="ot">&lt;-</span> <span class="fu">barplot</span>(lengthMeans, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(upperSE)), <span class="at">ylab =</span> <span class="st">'ln(wing length, mm)'</span>)</span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a><span class="co"># Now use the function to add error bars</span></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a><span class="co"># - draws arrows between the points (x0,y0) and (x1,y1)</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a><span class="co"># - arrow heads at each end (code=3) and at 90 degree angles</span></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a><span class="fu">arrows</span>(barMids, upperSE, barMids, lowerSE, <span class="at">ang=</span><span class="dv">90</span>, <span class="at">code=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_mod_activity_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br> Now we need to draw all these pieces together into a script and get used to using them.</p>
<p><span class="math inline">\star</span> Add all the lines of code from this section into your script. Run it and check you get the graph above.</p>
<p><span class="math inline">\star</span> Use the second two chunks as a model to plot a similar graph for food level</p>
<hr>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a>seMeanfood <span class="ot">&lt;-</span> <span class="cf">function</span>(x){ <span class="co"># get standard error of the mean from a set of values (x)</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>         x <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(x) <span class="co"># get rid of missing values</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>         se <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">var</span>(x)<span class="sc">/</span><span class="fu">length</span>(x)) <span class="co"># calculate the standard error</span></span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a>        <span class="fu">return</span>(se)  <span class="co"># tell the function to return the standard error</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>lengthMeansfood <span class="ot">&lt;-</span> <span class="fu">tapply</span>(mozwing<span class="sc">$</span>loglength, mozwing<span class="sc">$</span>food_level, <span class="at">FUN =</span> mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(lengthMeansfood)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      0.1         1 
0.9111556 1.0670992 </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>lengthSEfood <span class="ot">&lt;-</span> <span class="fu">tapply</span>(mozwing<span class="sc">$</span>loglength, mozwing<span class="sc">$</span>food_level, <span class="at">FUN =</span> seMeanfood)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(lengthSEfood)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>        0.1           1 
0.011887620 0.008825873 </code></pre>
</div>
</div>
<p><br> Lets get the upper and lower limits of the error bars:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a>upperSEfood <span class="ot">&lt;-</span> lengthMeansfood <span class="sc">+</span> lengthSEfood</span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>lowerSEfood <span class="ot">&lt;-</span> lengthMeansfood <span class="sc">-</span> lengthSEfood</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br> Now we should build a barplot - this function can report where the middle of the bars are on the x-axis - set the y axis limits to contain the error bars</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>barMidsfood <span class="ot">&lt;-</span> <span class="fu">barplot</span>(lengthMeansfood, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(upperSE)), <span class="at">ylab =</span> <span class="st">'ln(wing length, mm)'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_mod_activity_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br> Now use the function to add error bars - draws arrows between the points (x0,y0) and (x1,y1) - arrow heads at each end (code=3) and at 90 degree angles</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a>barMidsfood <span class="ot">&lt;-</span> <span class="fu">barplot</span>(lengthMeansfood, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(upperSE)), <span class="at">ylab =</span> <span class="st">'ln(wing length, mm)'</span>)</span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="fu">arrows</span>(barMidsfood, upperSEfood, barMidsfood, lowerSEfood, <span class="at">ang=</span><span class="dv">90</span>, <span class="at">code=</span><span class="dv">3</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_mod_activity_files/figure-html/unnamed-chunk-45-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="an-alternative-to-barplots" class="level3">
<h3 class="anchored" data-anchor-id="an-alternative-to-barplots">An alternative to barplots</h3>
<p>That is a lot of work to go through for a plot. Doing it the hard way uses some useful tricks, but one strength of <code>R</code> is that there is a huge list of add-on packages that you can use to get new functions that other people have written.</p>
<p>We will use the <code>gplots</code> package to create plots of group means and confidence intervals. Rather than plotting the means <span class="math inline">\pm</span> 1 standard error, the option <code>p=0.95</code> uses the standard error and the number of data points to get 95% confidence intervals. The default <code>connect=TRUE</code> option adds a line connecting the means, which isn’t useful here.</p>
<p><span class="math inline">\star</span> Replicate the code below into your script and run it to get the plots below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="co">#Load the gplots package</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(gplots)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Get plots of group means and standard errors</span></span>
<span id="cb70-5"><a href="#cb70-5" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</span>
<span id="cb70-6"><a href="#cb70-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plotmeans</span>(loglength <span class="sc">~</span> temp, <span class="at">data=</span>mozwing, <span class="at">p=</span><span class="fl">0.95</span>, <span class="at">connect=</span><span class="cn">FALSE</span>)</span>
<span id="cb70-7"><a href="#cb70-7" aria-hidden="true" tabindex="-1"></a><span class="fu">plotmeans</span>(loglength <span class="sc">~</span> food_level, <span class="at">data=</span>mozwing, <span class="at">p=</span><span class="fl">0.95</span>, <span class="at">connect=</span><span class="cn">FALSE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_mod_activity_files/figure-html/unnamed-chunk-46-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="analysis-of-variance" class="level2">
<h2 class="anchored" data-anchor-id="analysis-of-variance">Analysis of variance</h2>
<p>Hopefully, those plots should convince you that there are differences in wing length across temperatures and food levels. We’ll now use a linear model to test whether those differences are significant.</p>
<p><span class="math inline">\star</span> Using your code from the regression section as a guide, create a linear model called <code>lengthLM</code> which models wing length as a function of temperature.</p>
<p>Use <code>anova</code> and <code>summary</code> to look at the analysis of variance table and then the coefficients of the model.</p>
<p>The ANOVA table for the model should look like the one below: temperature explains highly significant variation in wing length(<span class="math inline">F= 30.5, \textrm{df}=2 \textrm{ and } 146, p =8.45e-12</span>)</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb71"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>lengthLM <span class="ot">&lt;-</span> <span class="fu">lm</span>(loglength <span class="sc">~</span> temp, <span class="at">data=</span>mozwing)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(lengthLM)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: loglength
           Df  Sum Sq  Mean Sq F value    Pr(&gt;F)    
temp        2 0.58891 0.294454  30.517 8.446e-12 ***
Residuals 146 1.40873 0.009649                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p><br> <em>Note the style of reporting the result</em> - the statistic (<span class="math inline">F</span>), degrees of freedom and <span class="math inline">p</span> value are all provided in support.</p>
<p>Pay close attention to the sum of squares column. This model is good, but some will not be. The important ratio is called <span class="math inline">r^2</span>, a measure of explanatory power, and shows that, although a model can be very significant, it might not be very explanatory. We care about explanatory power or effect size, <code>*not*</code> <span class="math inline">p</span> values.</p>
<p>The coefficients table for the model looks like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lengthLM)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = loglength ~ temp, data = mozwing)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.27446 -0.06218  0.02685  0.07266  0.14568 

Coefficients:
            Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  1.07379    0.01290  83.252  &lt; 2e-16 ***
temp26      -0.09129    0.01832  -4.983 1.75e-06 ***
temp32      -0.16063    0.02122  -7.571 3.87e-12 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.09823 on 146 degrees of freedom
  (121 observations deleted due to missingness)
Multiple R-squared:  0.2948,    Adjusted R-squared:  0.2851 
F-statistic: 30.52 on 2 and 146 DF,  p-value: 8.446e-12</code></pre>
</div>
</div>
<p><br> It shows the following:</p>
<ul>
<li>The reference level (or intercept) is for 22<span class="math inline">^\circ</span>C. The summary output indicates that wing length at this temperature is significantly different from zero - this is <em>not</em> an exciting finding!</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a>TukeyLength <span class="ot">&lt;-</span> <span class="fu">TukeyHSD</span>(<span class="fu">aov</span>(lengthLM))</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(TukeyLength)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Tukey multiple comparisons of means
    95% family-wise confidence level

Fit: aov(formula = lengthLM)

$temp
             diff        lwr         upr     p adj
26-22 -0.09129112 -0.1346712 -0.04791107 0.0000052
32-22 -0.16062514 -0.2108632 -0.11038706 0.0000000
32-26 -0.06933402 -0.1197347 -0.01893334 0.0039744</code></pre>
</div>
</div>
<p><br> The table shows the following:</p>
<ul>
<li><p>The differences between the three possible pairs and then the lower and upper bounds of the 95% confidence interval for the difference and a <span class="math inline">p</span> value.</p></li>
<li><p>In each case, we want to know if the difference could be zero: does the 95% confidence interval for each pair include zero?</p></li>
<li><p>For all pairs, the confidence intervals do not include zero, so they are significantly different. For example, comparison between 32 and 22<span class="math inline">^\circ</span>C, the interval does include zero (difference = -0.16, 95% CI’s limits are -0.21 &amp; -0.11), so these groups are significantly different.</p></li>
<li><p>The <span class="math inline">p</span> values for the top pairs are broadly consistent with the summary table. However, it may be harder to find significant results with a Tukey test in other cases.</p></li>
</ul>
<p>You can visualise these confidence intervals by plotting the Tukey test. You have to tweak the graphics parameters to get a clean plot though.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="fu">options</span>(<span class="at">repr.plot.res =</span> <span class="dv">100</span>, <span class="at">repr.plot.width =</span> <span class="dv">10</span>, <span class="at">repr.plot.height =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb79"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">las=</span><span class="dv">1</span>, <span class="at">mar=</span><span class="fu">c</span>(<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>,<span class="dv">5</span>))</span>
<span id="cb79-3"><a href="#cb79-3" aria-hidden="true" tabindex="-1"></a><span class="co"># las= 1 turns labels horizontal</span></span>
<span id="cb79-4"><a href="#cb79-4" aria-hidden="true" tabindex="-1"></a><span class="co"># mar makes the left margin wider (bottom, left, top, right)</span></span>
<span id="cb79-5"><a href="#cb79-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(TukeyLength)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_mod_activity_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><br> <span class="math inline">\star</span> Include the Tukey test in your script for both the temperature and food models.</p>
<section id="are-the-factors-independent" class="level3">
<h3 class="anchored" data-anchor-id="are-the-factors-independent">Are the factors independent?</h3>
<p>We’ve looked at two models, using temperature and food level. It is worth asking whether these are independent factors? This is important to know because otherwise, a two-way ANOVA would not be appropriate. We will look at interactions later.</p>
<p>OK, so we want to know whether the two factors are independent. This is a job for the <span class="math inline">\chi^2</span> test!</p>
</section>
</section>
<section id="the-chi-square-test-and-count-data" class="level2">
<h2 class="anchored" data-anchor-id="the-chi-square-test-and-count-data">The Chi-square test and count data</h2>
<p>The Chi-square test, also known as <span class="math inline">\chi^{2}</span> test or chi-square test, is designed for scenarios where you want to statistically test how likely it is that an observed distribution of values is due to chance. It is also called a “goodness of fit” statistic, because it measures how well the observed distribution of data fits with the distribution that is expected if the variables of which measurements are made are independent. In our wing length example below, the two variables are temperature and food level.</p>
<p>Note that a <span class="math inline">\chi^{2}</span> test is designed to analyze categorical data. That is the data have been counted (count data) and divided into categories. It is not meant for continuous data (such as body weight, genome size, or height). For example, if you want to test whether attending class influences how students perform on an exam, using test scores (from 0-100) as data would not be appropriate for a Chi-square test. However, arranging students into the categories “Pass” and “Fail” and counting up how many fall in each categories would be appropriate. Additionally, the data in a Chi-square table (see below) should not be in the form of percentages – only count data are allowed!</p>
<section id="the-chi-square-test-with-the-wing-length-data" class="level3">
<h3 class="anchored" data-anchor-id="the-chi-square-test-with-the-wing-length-data">The Chi-square test with the wing length data</h3>
<p>We can easily build a table for a Chi-square test on the wing length data as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>mozwing <span class="ot">&lt;-</span> mozwing[<span class="sc">!</span><span class="fu">is.na</span>(mozwing<span class="sc">$</span>loglength),] <span class="co"># subset data to omit cells for individuals that did not survive to adulthood</span></span>
<span id="cb80-2"><a href="#cb80-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb80-3"><a href="#cb80-3" aria-hidden="true" tabindex="-1"></a>factorTable <span class="ot">&lt;-</span> <span class="fu">table</span>(mozwing<span class="sc">$</span>food_level,mozwing<span class="sc">$</span>temp)</span>
<span id="cb80-4"><a href="#cb80-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(factorTable)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     
      22 26 32
  0.1 23 29 10
  1   35 28 24</code></pre>
</div>
</div>
<p><br> Now let’s run the test:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a><span class="fu">chisq.test</span>(factorTable)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
    Pearson's Chi-squared test

data:  factorTable
X-squared = 4.1883, df = 2, p-value = 0.1232</code></pre>
</div>
</div>
<p>The “X-squared” value is the <span class="math inline">\chi^{2}</span> <em>test statistic</em>, akin to the t-value of the t-test or W value in the Wilcox test.</p>
<p>The <span class="math inline">\chi^{2}</span> statistic is calculated as the sum of the quantity</p>
<p><span class="math display">\frac{(\mathrm{Observed} - \mathrm{Expected})^2}{\mathrm{Expected}}</span></p>
<p>across all the cells/categories in the table (so the sum would be over 6 categories in our current wing length example).</p>
<p>“Observed” is the observed proportion of data that fall in a certain category. For example, at 22°C there are 23 individuals observed in the <code>food level</code>, <code>0.1</code> category, and 35 in the <code>food level</code>, <code>1</code> category.</p>
<p>“Expected” is what count would be expected if the values in each category were truly independent. Each cell has its own expected value, which is simply calculated as the count one would expect in each category if the value were generated in proportion to the total number seen in that category. So in our example, the expected value for the <code>food level</code>, <code>0.1</code> category would be</p>
<p><span class="math inline">23+35 \mathrm{~(Total~number~of~low~food~individuals)} \times \frac{23+29+10 \mathrm{~(Total~number~in~the~"0.1"~category)}}{23+35+29+28+10+24 \mathrm{~(Total~number~of~individuals)}} = 58 \times \frac{62}{87} = 17.19</span></p>
<p>The sum of all six (one for each cell in the table above) such calculations would be the <span class="math inline">\chi^{2}</span> value that R gave you through the <code>chisq.test()</code> above — try it!</p>
<p>Now back to the R output from the <code>chisq.test()</code> above. Why df = 2? This is calculated as <span class="math inline">DF = (r - 1) * (c - 1)</span> where <span class="math inline">r</span> and <span class="math inline">c</span> are the number of rows and columns in the <span class="math inline">\chi^{2}</span> table, respectively. The same principle you learned before applies here; you lose one degree of freedom for each new level of information you need to estimate: there is uncertainity about the information (number of categories) in both rows and columns, so you need to lose one degree of freedom for each.</p>
<p>Finally, note that the p-value is non-significant — we can conclude that the factors are independent. This is expected because individuals could only be exposed to one of the six temperature-food treatments in the study’s experimental design. This dataset only contains females, however, the <code>chisq.test()</code> would be even more useful if the dataset contained values on both sexes. Later, we analyse these data using “interactions” later in multiple explanatory variables.</p>
<p><span class="math inline">\star</span> Include and run the <span class="math inline">\chi^2</span> test in your script.</p>
</section>
</section>
<section id="saving-data" class="level2">
<h2 class="anchored" data-anchor-id="saving-data">Saving data</h2>
<p>The last thing to do is to save a copy of the wing length data, including our new column of log data.</p>
<p><span class="math inline">\star</span> Use this code in your script to create the saved data in your <code>Data</code> directory :</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a><span class="fu">save</span>(mozwing, <span class="at">file=</span><span class="st">'mozwing.Rdata'</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="linear-models-multiple-explanatory-variables" class="level1">
<h1>Linear Models: Multiple explanatory variables</h1>
<section id="introduction-2" class="level2">
<h2 class="anchored" data-anchor-id="introduction-2">Introduction</h2>
<p>In this section we will explore fitting a linear model to data when you have multiple explanatory (predictor) variables.</p>
<p>The aims of this section are<a href="#fn1"><span class="math inline">^{[1]}</span></a>:</p>
<ul>
<li><p>Learning to build and fit a linear model that includes several explanatory variables</p></li>
<li><p>Learning to interpret the summary tables and diagnostics after fitting a linear model with multiple explanatory variables</p></li>
</ul>
</section>
<section id="an-example" class="level2">
<h2 class="anchored" data-anchor-id="an-example">An example</h2>
<p>We will now look at a single model that includes both explanatory variables.</p>
<p>The first thing to do is look at the data again.</p>
<section id="exploring-the-data-1" class="level3">
<h3 class="anchored" data-anchor-id="exploring-the-data-1">Exploring the data</h3>
<p><span class="math inline">\star</span> Create a new blank script called <code>MulExpl.R</code> in your <code>Code</code> directory and add some introductory comments.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a>wings <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"activities/data/traitdata_Huxleyetal_2021.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br> Look back at the end of the previous section to see how you saved the RData file. If <code>loglength</code> is missing, just add it to the imported data frame again (go back to the ANOVA section and have a look if you have forgotten how). Also, check to see if <code>temp</code> and <code>food_level</code> are defined as factors.</p>
<p>Use <code>ls()</code>, and then <code>str</code> to check that the data has loaded correctly:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(wings)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   270 obs. of  33 variables:
 $ ID                    : int  4 6 7 11 11 12 19 20 16 21 ...
 $ exp_no                : int  3 3 3 3 3 3 3 3 3 3 ...
 $ rep                   : chr  "A" "A" "A" "A" ...
 $ dens                  : num  0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 0.2 ...
 $ rearing_vessel        : chr  "tub" "tub" "tub" "tub" ...
 $ temp                  : int  22 22 22 22 22 22 22 22 22 22 ...
 $ food_level            : num  0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 0.1 ...
 $ treatment             : chr  "22_0.1" "22_0.1" "22_0.1" "22_0.1" ...
 $ feeding_interval      : int  24 24 24 24 24 24 24 24 24 24 ...
 $ egg_sub               : chr  "29/03/2019 12:00" "29/03/2019 12:00" "29/03/2019 12:00" "29/03/2019 12:00" ...
 $ l_emerg               : chr  "30/03/2019 12:00" "30/03/2019 12:00" "30/03/2019 12:00" "30/03/2019 12:00" ...
 $ l_emerg_days_frm_sub  : int  1 1 1 1 1 1 1 1 1 1 ...
 $ l_death               : chr  NA NA NA NA ...
 $ l_surv                : int  0 0 0 0 0 0 0 0 0 0 ...
 $ pupal_ref             : int  1 3 4 7 2 8 12 13 6 14 ...
 $ p_emerg               : chr  "26/04/2019 12:00" "27/04/2019 12:00" "28/04/2019 12:00" "02/05/2019 12:00" ...
 $ l_to_p_devtime        : int  28 29 30 34 30 34 35 36 32 36 ...
 $ l_to_p_devrate        : num  0.0357 0.0345 0.0333 0.0294 0.0333 ...
 $ p_death               : chr  NA NA NA NA ...
 $ p_surv                : int  0 0 0 0 0 0 0 0 0 0 ...
 $ a_emerg               : chr  "29/04/2019 12:00" "30/04/2019 12:00" "01/05/2019 12:00" "05/05/2019 12:00" ...
 $ p_to_a_devtime        : int  3 3 3 3 3 3 3 4 3 3 ...
 $ p_to_a_devrate        : num  0.333 0.333 0.333 0.333 0.333 ...
 $ a_death               : chr  "07/05/2019 12:00" "05/05/2019 12:00" "06/05/2019 12:00" "11/05/2019 12:00" ...
 $ adult_lifespan        : int  8 5 5 6 4 6 9 1 7 7 ...
 $ adult_mort_rate       : num  0.125 0.2 0.2 0.167 0.25 ...
 $ hatch_to_a_devtime    : int  31 32 33 37 33 37 38 40 35 39 ...
 $ hatch_to_adult_devrate: num  0.0323 0.0312 0.0303 0.027 0.0303 ...
 $ sex                   : chr  "female" "female" "female" "female" ...
 $ im_surv               : int  0 0 0 0 0 0 0 0 0 0 ...
 $ j_lifetime            : int  31 32 33 37 33 37 38 40 35 39 ...
 $ total_lifespan        : int  39 37 38 43 37 43 47 41 42 46 ...
 $ length_mm             : num  2.93 2.59 2.41 2.62 2.28 2.39 2.99 2.5 2.75 2.82 ...</code></pre>
</div>
</div>
<p><br> In the regression section, we asked if temperature and food level had meaningful effects on wing length. Now we want to ask questions like: How is the size-temperature relationship affected by different food levels?</p>
<p>We need to look at plots within groups.</p>
<p>Before we do that, there is a lot of data in the data frame that we don’t need for our analysis and we should make sure that we are using the same data for our plots and models. We will subset the data down to the complete data for the three variables and log the length of the wings:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb88"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1" aria-hidden="true" tabindex="-1"></a>wings <span class="ot">&lt;-</span> wings <span class="sc">%&gt;%</span></span>
<span id="cb88-2"><a href="#cb88-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">loglength =</span> <span class="fu">log</span>(length_mm))</span>
<span id="cb88-3"><a href="#cb88-3" aria-hidden="true" tabindex="-1"></a>wings <span class="ot">&lt;-</span> <span class="fu">subset</span>(wings, <span class="at">select =</span> <span class="fu">c</span>(temp, food_level, loglength)) </span>
<span id="cb88-4"><a href="#cb88-4" aria-hidden="true" tabindex="-1"></a>wings <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(wings)</span>
<span id="cb88-5"><a href="#cb88-5" aria-hidden="true" tabindex="-1"></a>wings<span class="sc">$</span>temp <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(wings<span class="sc">$</span>temp)</span>
<span id="cb88-6"><a href="#cb88-6" aria-hidden="true" tabindex="-1"></a>wings<span class="sc">$</span>food_level <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(wings<span class="sc">$</span>food_level)</span>
<span id="cb88-7"><a href="#cb88-7" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(wings)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   149 obs. of  3 variables:
 $ temp      : Factor w/ 3 levels "22","26","32": 1 1 1 1 1 1 1 1 1 1 ...
 $ food_level: Factor w/ 2 levels "0.1","1": 1 1 1 1 1 1 1 1 1 1 ...
 $ loglength : num  1.075 0.952 0.88 0.963 0.824 ...
 - attr(*, "na.action")= 'omit' Named int [1:121] 38 42 60 103 136 142 143 157 158 159 ...
  ..- attr(*, "names")= chr [1:121] "38" "42" "60" "103" ...</code></pre>
</div>
</div>
<div class="cell">
<pre class="tip cell-code"><code>Remember that lattice, like base R, will automatically plot boxplots when the explanatory variables of interest are defined as factors.</code></pre>
</div>
</section>
<section id="boxplots-within-groups" class="level3">
<h3 class="anchored" data-anchor-id="boxplots-within-groups">Boxplots within groups</h3>
<p>In the regression section, we used the <code>subset</code> option to fit a model just to dragonflies. You can use <code>subset</code> with plots too.</p>
<p><span class="math inline">\star</span> Add <code>par(mfrow=c(1,2))</code> to your script to split the graphics into two panels.</p>
<p><span class="math inline">\star</span> Copy over and modify the code from the ANOVA section to create a boxplot of genome size by trophic level into your script.</p>
<p><span class="math inline">\star</span> Now further modify the code to generate the plots shown in the figure below (you will have to <code>subset</code> your data for this, and also use the subset option of the <code>plot</code> command).</p>
<div class="cell">
<pre class="tip cell-code"><code>You can use the `plot` function's option `main = ` to add titles to a plot.</code></pre>
</div>
</section>
<section id="lattice-again" class="level3">
<h3 class="anchored" data-anchor-id="lattice-again"><code>lattice</code> again</h3>
<p>Recall that the <code>lattice</code> package provides some very neat extra ways to plot data in groups. They look pretty but the downside is that they don’t use the same graphics system — all those <code>par</code> commands are useless for these graphs. The defaults look good though!</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lattice)</span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a><span class="fu">bwplot</span>(loglength <span class="sc">~</span> temp <span class="sc">|</span> food_level, <span class="at">data=</span> wings)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_mod_activity_files/figure-html/unnamed-chunk-61-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The code <code>loglength ~ temp | food_level</code> means plot the relationship between wing length and temperature, but group within levels of food supply. We are using the function <code>bwplot</code>, which is provided by <code>lattice</code> to create box and whisker plots.</p>
<p><span class="math inline">\star</span> Create the lattice plots above from within your script.</p>
<p>Rearrange this code to have three plots, showing the box and whisker plots for <code>food_level</code>, grouped within the levels of <code>temp</code>.</p>
<p>Try reshaping the R plot window and running the command again. Lattice tries to make good use of the available space when creating lattice plots.</p>
</section>
<section id="barplots-again" class="level3">
<h3 class="anchored" data-anchor-id="barplots-again">Barplots again</h3>
<p>We’re going to make the barplot code from the regression section even more complicated! This time we want to know the mean log wing length within combinations of <code>temp</code> and <code>food_level</code>. We can still use <code>tapply</code>, providing more than one grouping factor. We create a set of grouping factors like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a>groups     <span class="ot">&lt;-</span> <span class="fu">list</span>(wings<span class="sc">$</span>temp, wings<span class="sc">$</span>food_level)</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>groupMeans <span class="ot">&lt;-</span> <span class="fu">tapply</span>(wings<span class="sc">$</span>loglength, groups, <span class="at">FUN =</span> mean)</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(groupMeans)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>         0.1         1
22 0.9720317 1.1406533
26 0.8937470 1.0744125
32 0.8216252 0.9513008</code></pre>
</div>
</div>
<p><span class="math inline">\star</span> Copy this code into your script and run it.</p>
<p>Use this code and the script from the ANOVA section to get the set of standard errors for the groups <code>groupSE</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>seMean <span class="ot">&lt;-</span> <span class="cf">function</span>(x){</span>
<span id="cb95-2"><a href="#cb95-2" aria-hidden="true" tabindex="-1"></a>    <span class="co"># get rid of missing values</span></span>
<span id="cb95-3"><a href="#cb95-3" aria-hidden="true" tabindex="-1"></a>    x <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(x)</span>
<span id="cb95-4"><a href="#cb95-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># calculate the standard error</span></span>
<span id="cb95-5"><a href="#cb95-5" aria-hidden="true" tabindex="-1"></a>    se <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">var</span>(x)<span class="sc">/</span><span class="fu">length</span>(x))</span>
<span id="cb95-6"><a href="#cb95-6" aria-hidden="true" tabindex="-1"></a>    <span class="co"># tell the function to report the standard error</span></span>
<span id="cb95-7"><a href="#cb95-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">return</span>(se)</span>
<span id="cb95-8"><a href="#cb95-8" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>groups <span class="ot">&lt;-</span> <span class="fu">list</span>(wings<span class="sc">$</span>food_level, wings<span class="sc">$</span>temp)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>groupMeans <span class="ot">&lt;-</span> <span class="fu">tapply</span>(wings<span class="sc">$</span>loglength, groups, <span class="at">FUN=</span>mean)</span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(groupMeans)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>           22       26        32
0.1 0.9720317 0.893747 0.8216252
1   1.1406533 1.074412 0.9513008</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a>groupSE <span class="ot">&lt;-</span> <span class="fu">tapply</span>(wings<span class="sc">$</span>loglength, groups, <span class="at">FUN=</span>seMean)</span>
<span id="cb98-2"><a href="#cb98-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(groupSE)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             22          26          32
0.1 0.017990977 0.014147233 0.019430021
1   0.004732957 0.005898363 0.005579193</code></pre>
</div>
</div>
<p><br> Now we can use <code>barplot</code>. The default option for a barplot of a table is to create a stacked barplot, which is not what we want. The option <code>beside=TRUE</code> makes the bars for each column appear side by side.</p>
<p>Once again, we save the midpoints of the bars to add the error bars. The other options in the code below change the colours of the bars and the length of error bar caps.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a><span class="co"># get upper and lower standard error height</span></span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>upperSE <span class="ot">&lt;-</span> groupMeans <span class="sc">+</span> groupSE</span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>lowerSE <span class="ot">&lt;-</span> groupMeans <span class="sc">-</span> groupSE</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="co"># create barplot</span></span>
<span id="cb100-5"><a href="#cb100-5" aria-hidden="true" tabindex="-1"></a>barMids <span class="ot">&lt;-</span> <span class="fu">barplot</span>(groupMeans, <span class="at">ylim=</span><span class="fu">c</span>(<span class="dv">0</span>, <span class="fu">max</span>(upperSE)), <span class="at">beside=</span><span class="cn">TRUE</span>, <span class="at">ylab=</span> <span class="st">' log (wing length (mm)) '</span> , <span class="at">col=</span><span class="fu">c</span>( <span class="st">' white '</span> , <span class="st">' grey70 '</span>))</span>
<span id="cb100-6"><a href="#cb100-6" aria-hidden="true" tabindex="-1"></a><span class="fu">arrows</span>(barMids, upperSE, barMids, lowerSE, <span class="at">ang=</span><span class="dv">90</span>, <span class="at">code=</span><span class="dv">3</span>, <span class="at">len=</span><span class="fl">0.05</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_mod_activity_files/figure-html/unnamed-chunk-66-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><span class="math inline">\star</span> Generate the barplot above and then edit your script to change the colours and error bar lengths to your taste.</p>
</section>
<section id="plotting-means-and-confidence-intervals" class="level3">
<h3 class="anchored" data-anchor-id="plotting-means-and-confidence-intervals">Plotting means and confidence intervals</h3>
<p>We’ll use the <code>plotmeans</code> function again as an exercise to change graph settings and to prepare figures for reports and write ups. This is the figure you should be able to reproduce the figure below.</p>
<hr>
<p><em>Replace image</em></p>
<p><small></small></p><small>
<center>
Means and 95% confidence intervals for logged wing length (mm) in <em>Aedes aegypti</em> for (a) different temperature levels and (b) for different larval food levels
</center>
</small><p><small></small></p>
<hr>
<p><span class="math inline">\star</span> Use <code>plotmeans</code> from the ANOVA section and the <code>subset</code> option to generate the two plots below. You will need to set the <code>ylim</code> option for the two plots to make them use the same <span class="math inline">y</span> axis.</p>
<p><span class="math inline">\star</span> Use <code>text</code> to add labels — the command <code>par('usr')</code> will show you the limits of the plot (<span class="math inline">x_{min}, x_{max}, y_{min}, y_{max}</span>) and help pick a location for the labels.</p>
<p><span class="math inline">\star</span> Change the <code>par</code> settings in your code and redraw the plots to try and make better use of the space. In the example below, the box shows the edges of the R graphics window.</p>
<p>Note the following about the the figure above (generated using plotmeans)):</p>
<ul>
<li><p><strong>White space</strong>: The default options in R use wide margins and spaced out axes and take up a lot of space that could be used for plotting data. You’ve already seen the <code>par</code> function and the options <code>mfrow</code> for multiple plots and <code>mar</code> to adjust margin size. The option <code>mgp</code> adjusts the placement of the axis label, tick labels and tick locations. See <code>?par</code> for help on the these options.</p></li>
<li><p><strong>Main titles</strong>: Adding large titles to graphs is also a bad idea — it uses lots of space to explain something that should be in the figure legend. With multiple plots in a figure, you have to label graphs so that the figure legend can refer to them. You can add labels using <code>text(x,y,'label')</code>.</p></li>
<li><p><strong>Figure legends</strong>: A figure caption and legend should give a clear stand-alone description of the whole figure.</p></li>
<li><p><strong>Referring to figures</strong>: You <em>must</em> link from your text to your figures — a reader has to know which figures refer to which results. So: “There are clear differences in mean genome size between species at different trophic levels and between ground dwelling and other species, Figure xx”.</p></li>
</ul>
</section>
</section>
<section id="fitting-the-linear-model" class="level2">
<h2 class="anchored" data-anchor-id="fitting-the-linear-model">Fitting the linear model</h2>
<p>All those exploratory visualizations suggest:</p>
<ul>
<li><p>Body size in <em>Aedes aegytpi</em> decreases with temperature, which is consistent with the size-temperature rule for many ectotherms.</p></li>
<li><p>Body size in <em>Aedes aegytpi</em> increases with larval food supply</p></li>
</ul>
<p>We suspected these things from the ANOVA section analyses, but now we can see that they might have separate effects. We’ll fit a linear model to explore this and add the two explanatory variables together.</p>
<p><span class="math inline">\star</span> This is an important section — read it through carefully and ask questions if you are unsure. Copy the code into your script and add comments. <em>Do not just jump to the next action item</em>!</p>
<p><span class="math inline">\star</span> First, fit the model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb101"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(loglength <span class="sc">~</span> temp <span class="sc">+</span> food_level, <span class="at">data =</span> mozwing)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We’re going to do things right this time and check the model diagnostics before we rush into interpretation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(repr) ; <span class="fu">options</span>(<span class="at">repr.plot.res =</span> <span class="dv">100</span>, <span class="at">repr.plot.width =</span> <span class="dv">7</span>, <span class="at">repr.plot.height =</span> <span class="dv">8</span>) <span class="co"># Change plot size</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_mod_activity_files/figure-html/unnamed-chunk-69-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb104"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb104-1"><a href="#cb104-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(repr) ; <span class="fu">options</span>(<span class="at">repr.plot.res =</span> <span class="dv">100</span>, <span class="at">repr.plot.width =</span> <span class="dv">6</span>, <span class="at">repr.plot.height =</span> <span class="dv">6</span>) <span class="co"># Change plot size</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br> Examine these diagnostic plots. There are six predicted values now - three temperature levels for each of the two food levels. Those plots look ok so now we can look at the analysis of variance table:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: loglength
            Df  Sum Sq Mean Sq F value    Pr(&gt;F)    
temp         2 0.58891 0.29445  96.404 &lt; 2.2e-16 ***
food_level   1 0.96584 0.96584 316.215 &lt; 2.2e-16 ***
Residuals  145 0.44288 0.00305                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p><br> <em>Ignore the</em> <span class="math inline">p</span> values! Yes, they’re highly significant but we want to understand the model, not rubber stamp it with ‘significant’.</p>
<p>The sums of squares for the variables are both large compared to the residual sums of squares — there is lots of explained variation! We can calculate the <span class="math inline">r^2</span> as explained sums of squares over total sums of squares:</p>
<p><span class="math display">\frac{0.59 + 0.97}{0.59 + 0.97 + 0.44} = \frac{3.56}{16.77} = 0.78</span></p>
<p>Food level explain more variation than temperature — this makes intuitive sense from the plots since there are big differences between in the figure we generated above (using plotmeans) (a vs b), but smaller differences within.</p>
<p>We could also calculate a significance for the whole model by merging the terms. The total explained sums of squares of <span class="math inline">0.59 + 0.97 = 1.56</span> uses <span class="math inline">2+1 =3</span> degrees of freedom, so the mean sums of squares for all the terms together is <span class="math inline">1.56/3=0.52</span>. Dividing this by the residual mean square of 0.003 gives an F of <span class="math inline">0.52 / 0.003 = 173.33</span>.</p>
<p>Now we can look at the summary table to see the coefficients:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = loglength ~ temp + food_level, data = mozwing)

Residuals:
      Min        1Q    Median        3Q       Max 
-0.193070 -0.024347  0.004734  0.032994  0.121469 

Coefficients:
             Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)  0.973804   0.009180 106.078  &lt; 2e-16 ***
temp26      -0.072698   0.010361  -7.017 8.05e-11 ***
temp32      -0.177597   0.011975 -14.830  &lt; 2e-16 ***
food_level1  0.165684   0.009317  17.782  &lt; 2e-16 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.05527 on 145 degrees of freedom
Multiple R-squared:  0.7783,    Adjusted R-squared:  0.7737 
F-statistic: 169.7 on 3 and 145 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p><br> Starting at the bottom of this output, <code>summary</code> has again calculated <span class="math inline">r^2</span> for us and also an <span class="math inline">F</span> statistic for the whole model, which matches the calculation above.</p>
<p>The other important bits are the four coefficients. The intercept is now the reference level for two variables: it is the mean for individuals that were reared at 22°C with low food supply (0.1 mg day^-1). We then have differences from this value for individuals reared at the other temperatures. There is a big change in wing length associated with increased temperature and food level and both of these have large effects sizes. Increasing temperature from 22°C to 32°C introduced about a 20% difference in wing length. Increased food at 22°C increased wing by ~20%.</p>
<p>Because the difference is large and the standard error is small, the <span class="math inline">t</span> value suggests that this difference did not arise just by chance. Put another way, it is significant.</p>
<p>The table below shows how these four coefficients combine to give the predicted values for each of the group means.</p>
<table class="table">
<colgroup>
<col style="width: 15%">
<col style="width: 23%">
<col style="width: 29%">
<col style="width: 30%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;">22°C</th>
<th style="text-align: left;">26°C</th>
<th style="text-align: left;">32°C</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>low food</strong></td>
<td style="text-align: left;"><em>0.98</em> = 0.98</td>
<td style="text-align: left;"><em>0.98 - 0.07</em> = 0.91</td>
<td style="text-align: left;"><em>0.98 - 0.18</em> = 0.70</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>high food</strong></td>
<td style="text-align: left;"><em>0.98 + 0.17</em> = 1.15</td>
<td style="text-align: left;"><em>0.98 - 0.07 + 0.17</em> =1.08</td>
<td style="text-align: left;"><em>0.98 - 0.18 + 0.17</em> = 0.97</td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="linear-models-multiple-variables-with-interactions" class="level1">
<h1>Linear Models: Multiple variables with interactions</h1>
<section id="introduction-3" class="level2">
<h2 class="anchored" data-anchor-id="introduction-3">Introduction</h2>
<p>Here you will build on your skills in fitting linear models with multiple explanatory variables to data. You will learn about another commonly used Linear Model fitting technique: ANCOVA.</p>
<p>We will build two models in this section:</p>
<ul>
<li><p><strong>Model 1</strong>: Is <em>Ae. aegypti</em> wing length predicted by interactions between temperature and food level?</p></li>
<li><p><strong>ANCOVA</strong>: Is body size in Odonata predicted by interactions between genome size and taxonomic suborder?</p></li>
</ul>
<p>So far, we have only looked at the independent effects of variables. For example, in the temperature and food level model from the first multiple explanatory variables section, we only looked for specific differences for being exposed to low larval food supply <em>or</em> high larval food supply, not for being specifically reared at a specific <em>temperature-food level treatment</em>. These independent effects of a variable are known as <em>main effects</em> and the effects of combinations of variables acting together are known as <em>interactions</em> — they describe how the variables <em>interact</em>.</p>
<section id="section-aims" class="level3">
<h3 class="anchored" data-anchor-id="section-aims">Section aims</h3>
<p>The aims of this section are<a href="#fn1"><span class="math inline">^{[1]}</span></a>:</p>
<ul>
<li><p>Creating more complex Linear Models with multiple explanatory variables</p></li>
<li><p>Including the effects of interactions between multiple variables in a linear model</p></li>
<li><p>Plotting predictions from more complex (multiple explanatory variables) linear models</p></li>
</ul>
</section>
<section id="formulae-with-interactions-in-r" class="level3">
<h3 class="anchored" data-anchor-id="formulae-with-interactions-in-r">Formulae with interactions in R</h3>
<p>We’ve already seen a number of different model formulae in R. They all use this syntax:</p>
<p><code>response variable ~&nbsp;explanatory variable(s)</code></p>
<p>But we are now going to see two extra pieces of syntax:</p>
<ul>
<li><p><code>y ~ a + b + a:b</code>: The <code>a:b</code> means the interaction between <code>a</code> and <code>b</code> — do combinations of these variables lead to different outcomes?</p></li>
<li><p><code>y ~ a * b</code>: This a shorthand for the model above. The means fit <code>a</code> and <code>b</code> as main effects and their interaction <code>a:b</code>.</p></li>
</ul>
</section>
</section>
<section id="model-1-aedes-aegypti-wing-length" class="level2">
<h2 class="anchored" data-anchor-id="model-1-aedes-aegypti-wing-length">Model 1: <em>Aedes aegypti</em> wing length</h2>
<p><span class="math inline">\star</span> Make sure you have changed the working directory to <code>Code</code> in your stats coursework directory.</p>
<p><span class="math inline">\star</span> Create a new blank script called ‘Interactions.R’ and add some introductory comments.</p>
<p><span class="math inline">\star</span> Read in the data:</p>
<p>For practice, subset the dataset, define any categorical variables, and add any columns that might missing. Revist the previous sections, if you have forgotten what is needed!</p>
<p>Let’s refit the model from the earlier multiple explanatory variable section, but including the interaction between temperature and food level. We’ll immediately check the model is appropriate:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(loglength <span class="sc">~</span> temp <span class="sc">*</span> food_level, <span class="at">data=</span> wings)</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">2</span>), <span class="at">mar=</span><span class="fu">c</span>(<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">1</span>,<span class="dv">1</span>), <span class="at">mgp=</span><span class="fu">c</span>(<span class="dv">2</span>, <span class="fl">0.8</span>,<span class="dv">0</span>))</span>
<span id="cb109-3"><a href="#cb109-3" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(model)   </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_mod_activity_files/figure-html/unnamed-chunk-74-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Now, examine the <code>anova</code> and <code>summary</code> outputs for the model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb110"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb110-1"><a href="#cb110-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: loglength
                 Df  Sum Sq Mean Sq  F value Pr(&gt;F)    
temp              2 0.58891 0.29445  97.8286 &lt;2e-16 ***
food_level        1 0.96584 0.96584 320.8883 &lt;2e-16 ***
temp:food_level   2 0.01247 0.00623   2.0714 0.1298    
Residuals       143 0.43042 0.00301                    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p><br> Compared to the model from the first multiple explanatory variables section, there is an extra line at the bottom. The top two are the same and show that temperature and food level both have independent main effects. The extra line shows that there is also an interaction between the two. It doesn’t explain very much variation, and it is non-significant.</p>
<p>Again, we can calculate the <span class="math inline">r^2</span> for the model:</p>
<p><span class="math inline">\frac{0.59 + 0.97 + 0.01}{0.59 + 0.97 + 0.01 + 0.43} = 0.78</span></p>
<p>The model from the first multiple explanatory variables section without the interaction had an <span class="math inline">r^2 = 0.78</span> — our new model explains 0% more of the variation in the data.</p>
<p>The summary table is as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = loglength ~ temp * food_level, data = wings)

Residuals:
     Min       1Q   Median       3Q      Max 
-0.18571 -0.02245  0.00357  0.03279  0.12510 

Coefficients:
                   Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)         0.97203    0.01144  84.971  &lt; 2e-16 ***
temp26             -0.07828    0.01532  -5.110 1.01e-06 ***
temp32             -0.15041    0.02078  -7.238 2.57e-11 ***
food_level1         0.16862    0.01473  11.450  &lt; 2e-16 ***
temp26:food_level1  0.01204    0.02069   0.582    0.561    
temp32:food_level1 -0.03895    0.02536  -1.536    0.127    
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.05486 on 143 degrees of freedom
Multiple R-squared:  0.7845,    Adjusted R-squared:  0.777 
F-statistic: 104.1 on 5 and 143 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p><br> The lines in this output are:</p>
<ol type="1">
<li>The reference level (intercept) for low-food at 22°C. (The reference level is decided just by alphabetic/numeric order of the levels)</li>
<li>Two differences for being in different food levels.</li>
<li>One difference for being high-food at 22°C.</li>
<li>Two new differences that give specific differences for high-food at 26 and 32°C.</li>
</ol>
<p>The first four lines, as in the model from the ANOVA section, which would allow us to find the predicted values for each group <em>if the size of the differences did not vary between levels because of the interactions</em>. That is, this part of the model only includes a single difference low-food and high-food, which has to be the same for each temperature because it ignores interactions between temperature and low- / high-food identity of each treatment. The last two lines then give the estimated coefficients associated with the interaction terms, and allow cause the size of differences to vary between levels because of the further effects of interactions.</p>
<p>The table below show how these combine to give the predictions for each group combination, with those two new lines show in red:</p>
<table class="table">
<colgroup>
<col style="width: 11%">
<col style="width: 23%">
<col style="width: 64%">
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"></th>
<th style="text-align: left;"><strong>low food</strong></th>
<th style="text-align: left;"><strong>high food</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>22°C</strong></td>
<td style="text-align: left;">0.97 = 0.97</td>
<td style="text-align: left;">0.97 + 0.17 = 1.14</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>26°C</strong></td>
<td style="text-align: left;">0.97 - 0.08 = 0.89</td>
<td style="text-align: left;">0.97 - 0.08 + 0.17<span style="color:red">+ 0.01</span> = 1.07</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>32°C</strong></td>
<td style="text-align: left;">0.97 - 0.15 = 0.82</td>
<td style="text-align: left;">0.97 - 0.15 + 0.17<span style="color:red">- 0.04</span> = 0.95</td>
</tr>
</tbody>
</table>
<p>So why are there two new coefficients? For interactions between two factors, there are always <span class="math inline">(n-1)\times(m-1)</span> new coefficients, where <span class="math inline">n</span> and <span class="math inline">m</span> are the number of levels in the two factors (low- or high-food: 2 levels and temperature: 3 levels, in our current example). So in this model, <span class="math inline">(3-1) \times (2-1) =2</span>. It might be easier to understand why graphically:</p>
<p><img src="interactionsdiag.png" width="500px"></p>
<p>The prediction for the white boxes above can be found by adding the main effects together but for the grey boxes, we need to find specific differences. So there are <span class="math inline">(n-1)\times(m-1)</span> interaction coefficients (count the number of grey boxes) to add.</p>
<p>If we put this together, what is the model telling us?</p>
<ul>
<li>The interaction model does’t tell us anything more than the model without interactions – body size in <em>Ae. aegypti</em> decreases with temperature and increases with food level.</li>
</ul>
<p>This finding suggests that food limitation can exacerbate the negative effect that increased temperature has on body size. However, the interaction term in the <code>anova</code> output suggests that variation between food levels in degree to which body size decreases with temperature is non-significant.</p>
<p><span class="math inline">\star</span> Copy the code above into your script and run the model.</p>
<p>Make sure you understand the output!</p>
<p>Just to make sure the sums above are correct, we’ll use the same code as in earlier multiple explanatory variables section to get R to calculate predictions for us, similar to the way we did before:</p>
<p>Again, remember that the <code>each = 2</code> option repeats each value twice in succession; the <code>times = 3</code> options repeats the whole set of values (the whole vector) three times.</p>
<p><span class="math inline">\star</span> Include and run the code for gererating these predictions in your script.</p>
<p>If we plot these data points onto the barplot from the first multiple explanatory variables section, they now lie exactly on the mean values, because we’ve allowed for interactions. How much overlap would you expect, if you were to plot the predictions from the model without the interaction term?</p>
</section>
<section id="model-2-ancova-body-weight-in-odonata" class="level2">
<h2 class="anchored" data-anchor-id="model-2-ancova-body-weight-in-odonata">Model 2 (ANCOVA): Body Weight in Odonata</h2>
<p>We’ll go all the way back to the regression analyses from the Regression section. Remember that we fitted two separate regression lines to the data for damselflies and dragonflies. We’ll now use an interaction to fit these in a single model. This kind of linear model — with a mixture of continuous variables and factors — is often called an <em>analysis of covariance</em>, or ANCOVA. That is, ANCOVA is a type of linear model that blends ANOVA and regression. ANCOVA evaluates whether population means of a dependent variable are equal across levels of a categorical independent variable, while statistically controlling for the effects of other continuous variables that are not of primary interest, known as covariates.</p>
<p><em>Thus, ANCOVA is a linear model with one categorical and one or more continuous predictors</em>.</p>
<p>We will use the odonates data.</p>
<p><span class="math inline">\star</span> First load the data:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb114"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb114-1"><a href="#cb114-1" aria-hidden="true" tabindex="-1"></a>odonata <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"activities/data/GenomeSize.csv"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br> <br> <span class="math inline">\star</span> Now create two new variables in the <code>odonata</code> data set called <code>logGS</code> and <code>logBW</code> containing log genome size and log body weight:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a>odonata<span class="sc">$</span>logGS <span class="ot">&lt;-</span> <span class="fu">log</span>(odonata<span class="sc">$</span>GenomeSize)</span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>odonata<span class="sc">$</span>logBW <span class="ot">&lt;-</span> <span class="fu">log</span>(odonata<span class="sc">$</span>BodyWeight)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br> The models we fitted before looked like this:</p>
<p><img src="dragonData.svg" width="500px"></p>
<p>We can now fit the model of body weight as a function of both genome size and suborder:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb116"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb116-1"><a href="#cb116-1" aria-hidden="true" tabindex="-1"></a>odonModel <span class="ot">&lt;-</span> <span class="fu">lm</span>(logBW <span class="sc">~</span> logGS <span class="sc">*</span> Suborder, <span class="at">data =</span> odonata)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(odonModel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = logBW ~ logGS * Suborder, data = odonata)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.3243 -0.3225  0.0073  0.3962  1.4976 

Coefficients:
                        Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)             -2.39947    0.08475 -28.311  &lt; 2e-16 ***
logGS                    1.00522    0.22367   4.494 1.99e-05 ***
SuborderZygoptera       -2.24895    0.13540 -16.610  &lt; 2e-16 ***
logGS:SuborderZygoptera -2.14919    0.46186  -4.653 1.07e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.6499 on 94 degrees of freedom
  (2 observations deleted due to missingness)
Multiple R-squared:  0.7549,    Adjusted R-squared:  0.7471 
F-statistic:  96.5 on 3 and 94 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p><br> Again, we’ll look at the anova table first:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(odonModel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: logBW
               Df  Sum Sq Mean Sq F value    Pr(&gt;F)    
logGS           1   1.144   1.144   2.710    0.1031    
Suborder        1 111.968 111.968 265.133 &lt; 2.2e-16 ***
logGS:Suborder  1   9.145   9.145  21.654 1.068e-05 ***
Residuals      94  39.697   0.422                      
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p><br> Interpreting this:</p>
<ul>
<li><p>There is no significant main effect of log genome size. The <em>main</em> effect is the important thing here — genome size is hugely important but does very different things for the two different suborders. If we ignored <code>Suborder</code>, there isn’t an overall relationship: the average of those two lines is pretty much flat.</p></li>
<li><p>There is a very strong main effect of Suborder: the mean body weight in the two groups are very different.</p></li>
<li><p>There is a strong interaction between suborder and genome size. This is an interaction between a factor and a continuous variable and shows that the <em>slopes</em> are different for the different factor levels.</p></li>
</ul>
<p>Now for the summary table:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(odonModel)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
lm(formula = logBW ~ logGS * Suborder, data = odonata)

Residuals:
    Min      1Q  Median      3Q     Max 
-1.3243 -0.3225  0.0073  0.3962  1.4976 

Coefficients:
                        Estimate Std. Error t value Pr(&gt;|t|)    
(Intercept)             -2.39947    0.08475 -28.311  &lt; 2e-16 ***
logGS                    1.00522    0.22367   4.494 1.99e-05 ***
SuborderZygoptera       -2.24895    0.13540 -16.610  &lt; 2e-16 ***
logGS:SuborderZygoptera -2.14919    0.46186  -4.653 1.07e-05 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1

Residual standard error: 0.6499 on 94 degrees of freedom
  (2 observations deleted due to missingness)
Multiple R-squared:  0.7549,    Adjusted R-squared:  0.7471 
F-statistic:  96.5 on 3 and 94 DF,  p-value: &lt; 2.2e-16</code></pre>
</div>
</div>
<p><br> - The first thing to note is that the <span class="math inline">r^2</span> value is really high. The model explains three quarters (0.752) of the variation in the data.</p>
<ul>
<li><p>Next, there are four coefficients:</p>
<ul>
<li>The intercept is for the first level of <code>Suborder</code>, which is Anisoptera (dragonflies).</li>
<li>The next line, for <code>log genome size</code>, is the slope for Anisoptera.</li>
<li>We then have a coefficient for the second level of <code>Suborder</code>, which is Zygoptera (damselflies). As with the first model, this difference in factor levels is a difference in mean values and shows the difference in the intercept for Zygoptera.</li>
<li>The last line is the interaction between <code>Suborder</code> and <code>logGS</code>. This shows how the slope for Zygoptera differs from the slope for Anisoptera.</li>
</ul></li>
</ul>
<p>How do these hang together to give the two lines shown in the model? We can calculate these by hand:</p>
<span class="math display">\begin{align*}
\textrm{Body Weight} &amp;= -2.40 + 1.01 \times \textrm{logGS} &amp; \textrm{[Anisoptera]}\\
\textrm{Body Weight} &amp;= (-2.40 -2.25) + (1.01 - 2.15) \times \textrm{logGS} &amp; \textrm{[Zygoptera]}\\
        &amp;= -4.65 - 1.14 \times \textrm{logGS}
\end{align*}</span>
<p><span class="math inline">\star</span> Add the above code into your script and check that you understand the outputs.</p>
<p>We’ll use the <code>predict</code> function again to get the predicted values from the model and add lines to the plot above.</p>
<p>First, we’ll create a set of numbers spanning the range of genome size:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb123"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb123-1"><a href="#cb123-1" aria-hidden="true" tabindex="-1"></a><span class="co">#get the range of the data:</span></span>
<span id="cb123-2"><a href="#cb123-2" aria-hidden="true" tabindex="-1"></a>rng <span class="ot">&lt;-</span> <span class="fu">range</span>(odonata<span class="sc">$</span>logGS)</span>
<span id="cb123-3"><a href="#cb123-3" aria-hidden="true" tabindex="-1"></a><span class="co">#get a sequence from the min to the max with 100 equally spaced values:</span></span>
<span id="cb123-4"><a href="#cb123-4" aria-hidden="true" tabindex="-1"></a>LogGSForFitting <span class="ot">&lt;-</span> <span class="fu">seq</span>(rng[<span class="dv">1</span>], rng[<span class="dv">2</span>], <span class="at">length =</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br> Have a look at these numbers:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(LogGSForFitting)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  [1] -0.891598119 -0.873918728 -0.856239337 -0.838559945 -0.820880554
  [6] -0.803201163 -0.785521772 -0.767842380 -0.750162989 -0.732483598
 [11] -0.714804206 -0.697124815 -0.679445424 -0.661766032 -0.644086641
 [16] -0.626407250 -0.608727859 -0.591048467 -0.573369076 -0.555689685
 [21] -0.538010293 -0.520330902 -0.502651511 -0.484972119 -0.467292728
 [26] -0.449613337 -0.431933946 -0.414254554 -0.396575163 -0.378895772
 [31] -0.361216380 -0.343536989 -0.325857598 -0.308178207 -0.290498815
 [36] -0.272819424 -0.255140033 -0.237460641 -0.219781250 -0.202101859
 [41] -0.184422467 -0.166743076 -0.149063685 -0.131384294 -0.113704902
 [46] -0.096025511 -0.078346120 -0.060666728 -0.042987337 -0.025307946
 [51] -0.007628554  0.010050837  0.027730228  0.045409619  0.063089011
 [56]  0.080768402  0.098447793  0.116127185  0.133806576  0.151485967
 [61]  0.169165358  0.186844750  0.204524141  0.222203532  0.239882924
 [66]  0.257562315  0.275241706  0.292921098  0.310600489  0.328279880
 [71]  0.345959271  0.363638663  0.381318054  0.398997445  0.416676837
 [76]  0.434356228  0.452035619  0.469715011  0.487394402  0.505073793
 [81]  0.522753184  0.540432576  0.558111967  0.575791358  0.593470750
 [86]  0.611150141  0.628829532  0.646508923  0.664188315  0.681867706
 [91]  0.699547097  0.717226489  0.734905880  0.752585271  0.770264663
 [96]  0.787944054  0.805623445  0.823302836  0.840982228  0.858661619</code></pre>
</div>
</div>
<p><br> We can now use the model to predict the values of body weight at each of those points for each of the two suborders:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb126"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb126-1"><a href="#cb126-1" aria-hidden="true" tabindex="-1"></a><span class="co">#get a data frame of new data for the order</span></span>
<span id="cb126-2"><a href="#cb126-2" aria-hidden="true" tabindex="-1"></a>ZygoVals <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">logGS =</span> LogGSForFitting, <span class="at">Suborder =</span> <span class="st">"Zygoptera"</span>)</span>
<span id="cb126-3"><a href="#cb126-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-4"><a href="#cb126-4" aria-hidden="true" tabindex="-1"></a><span class="co">#get the predictions and standard error</span></span>
<span id="cb126-5"><a href="#cb126-5" aria-hidden="true" tabindex="-1"></a>ZygoPred <span class="ot">&lt;-</span> <span class="fu">predict</span>(odonModel, <span class="at">newdata =</span> ZygoVals, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span>
<span id="cb126-6"><a href="#cb126-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb126-7"><a href="#cb126-7" aria-hidden="true" tabindex="-1"></a><span class="co">#repeat for anisoptera</span></span>
<span id="cb126-8"><a href="#cb126-8" aria-hidden="true" tabindex="-1"></a>AnisoVals <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">logGS =</span> LogGSForFitting, <span class="at">Suborder =</span> <span class="st">"Anisoptera"</span>)</span>
<span id="cb126-9"><a href="#cb126-9" aria-hidden="true" tabindex="-1"></a>AnisoPred <span class="ot">&lt;-</span> <span class="fu">predict</span>(odonModel, <span class="at">newdata =</span> AnisoVals, <span class="at">se.fit =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br> We’ve added <code>se.fit=TRUE</code> to the function to get the standard error around the regression lines. Both <code>AnisoPred</code> and <code>ZygoPred</code> contain predicted values (called <code>fit</code>) and standard error values (called <code>se.fit</code>) for each of the values in our generated values in <code>LogGSForFitting</code> for each of the two suborders.</p>
<p>We can add the predictions onto a plot like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb127"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb127-1"><a href="#cb127-1" aria-hidden="true" tabindex="-1"></a><span class="co"># plot the scatterplot of the data</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb128"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb128-1"><a href="#cb128-1" aria-hidden="true" tabindex="-1"></a>odonata<span class="sc">$</span>Suborder <span class="ot">&lt;-</span> <span class="fu">as.factor</span>(odonata<span class="sc">$</span>Suborder)</span>
<span id="cb128-2"><a href="#cb128-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(logBW <span class="sc">~</span> logGS, <span class="at">data =</span> odonata, <span class="at">col =</span> Suborder)</span>
<span id="cb128-3"><a href="#cb128-3" aria-hidden="true" tabindex="-1"></a><span class="co"># add the predicted lines</span></span>
<span id="cb128-4"><a href="#cb128-4" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(AnisoPred<span class="sc">$</span>fit <span class="sc">~</span> LogGSForFitting, <span class="at">col =</span> <span class="st">"black"</span>)</span>
<span id="cb128-5"><a href="#cb128-5" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(AnisoPred<span class="sc">$</span>fit <span class="sc">+</span> AnisoPred<span class="sc">$</span>se.fit <span class="sc">~</span> LogGSForFitting, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span>
<span id="cb128-6"><a href="#cb128-6" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(AnisoPred<span class="sc">$</span>fit <span class="sc">-</span> AnisoPred<span class="sc">$</span>se.fit <span class="sc">~</span> LogGSForFitting, <span class="at">col =</span> <span class="st">"black"</span>, <span class="at">lty =</span> <span class="dv">2</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="linear_mod_activity_files/figure-html/unnamed-chunk-91-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p><span class="math inline">\star</span> Copy the prediction code into your script and run the plot above.</p>
<p>Copy and modify the last three lines to add the lines for the Zygoptera. Your final plot should look like this:</p>
<p><img src="odonPlot.svg" width="500px"></p>
<hr>
</section>
</section>
<section id="model-simplification" class="level1">
<h1>Model simplification</h1>
<section id="introduction-4" class="level2">
<h2 class="anchored" data-anchor-id="introduction-4">Introduction</h2>
<p>In biology, we often use statistics to compare competing hypotheses in order to work out the simplest explanation for some data. This often involves collecting several explanatory variables that describe different hypotheses and then fitting them together in a single model, and often including interactions between those variables.</p>
<p>In all likelihood, not all of these model <em>terms</em> will be important. If we remove unimportant terms, then the explanatory power of the model will get worse, but might not get significantly worse.</p>
<blockquote class="blockquote">
<p><em>“It can scarcely be denied that the supreme goal of all theory is to make the irreducible basic elements as simple and as few as possible without having to surrender the adequate representation of a single datum of experience.”</em></p>
<p>– <em>Albert Einstein</em></p>
</blockquote>
<p>Or to paraphrase:</p>
<blockquote class="blockquote">
<p><em>“Everything should be made as simple as possible, but no simpler.”</em></p>
</blockquote>
<p>The approach we will look at is to start with a <em>maximal model</em> — the model that contains everything that might be important — and simplify it towards the <em>null model</em> — the model that says that none of your variables are important. Hopefully, there is a point somewhere in between where you can’t remove any further terms without making the model significantly worse: this is called the <em>minimum adequate model</em>.</p>
<p><img src="minmodflow.png" width="500px"></p>
<section id="section-aims-1" class="level3">
<h3 class="anchored" data-anchor-id="section-aims-1">Section aims</h3>
<p>The main aim of this section<a href="#fn1"><span class="math inline">^{[1]}</span></a> is to learn how to build and then simplify complex models by removing non-explanatory terms, to arrive at the <em>Minimum Adequate Model</em>.</p>
</section>
<section id="the-process-of-model-simplification" class="level3">
<h3 class="anchored" data-anchor-id="the-process-of-model-simplification">The process of model simplification</h3>
<p>Model simplification is an iterative process. The flow diagram below shows how it works: at each stage you try and find an acceptable simplification. If successful, then you start again with the new simpler model and try and find a way to simplify this, until eventually, you can’t find anything more to remove.</p>
<p><img src="maxmodflow.png" width="500px"></p>
<p>As always, we can use an <span class="math inline">F</span>-test to compare two models and see if they have significantly different explanatory power (there are also other ways to do this, such as using the Akaike Information Criterion, but we will not cover this here). In this context, the main thing to remember is that significance of the <span class="math inline">F</span>-test used to compare a model and its simplified counterpart is a <em>bad</em> thing — it means that we’ve removed a term from the fitted model that makes it <em>significantly</em> worse.</p>
</section>
</section>
<section id="an-example-1" class="level2">
<h2 class="anchored" data-anchor-id="an-example-1">An example</h2>
<p>We’ll be using the wing length dataset for this practical, so once again:</p>
<p><span class="math inline">\star</span> Make sure you have changed the working directory to your stats module <code>code</code> folder.</p>
<p><span class="math inline">\star</span> Create a new blank script called <code>MyModelSimp.R</code>.</p>
<p><span class="math inline">\star</span> Load the wing length data into a data frame called <code>wings</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb129"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb129-1"><a href="#cb129-1" aria-hidden="true" tabindex="-1"></a>wings <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">'activities/data/traitdata_Huxleyetal_2021.csv'</span>,<span class="at">stringsAsFactors =</span> <span class="cn">TRUE</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br> In previous sections, we looked at how the categorical variables <code>temp</code> and <code>food_level</code> predicted wing length in in <em>Aedes aegypti</em>. In this section, we will add in another continuous variable: adult lifespan. The first thing we will do is to log both variables and reduce the dataset to the rows for which all of these data are available:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb130"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb130-1"><a href="#cb130-1" aria-hidden="true" tabindex="-1"></a>wings<span class="sc">$</span>temp       <span class="ot">&lt;-</span> <span class="fu">as_factor</span>(wings<span class="sc">$</span>temp)</span>
<span id="cb130-2"><a href="#cb130-2" aria-hidden="true" tabindex="-1"></a>wings<span class="sc">$</span>food_level <span class="ot">&lt;-</span> <span class="fu">as_factor</span>(wings<span class="sc">$</span>food_level)</span>
<span id="cb130-3"><a href="#cb130-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-4"><a href="#cb130-4" aria-hidden="true" tabindex="-1"></a>wings<span class="sc">$</span>loglength   <span class="ot">&lt;-</span> <span class="fu">log</span>(wings<span class="sc">$</span>length_mm)</span>
<span id="cb130-5"><a href="#cb130-5" aria-hidden="true" tabindex="-1"></a>wings<span class="sc">$</span>loglifespan <span class="ot">&lt;-</span> <span class="fu">log</span>(wings<span class="sc">$</span>adult_lifespan)</span>
<span id="cb130-6"><a href="#cb130-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-7"><a href="#cb130-7" aria-hidden="true" tabindex="-1"></a><span class="co"># reduce dataset to four key variables</span></span>
<span id="cb130-8"><a href="#cb130-8" aria-hidden="true" tabindex="-1"></a>wings <span class="ot">&lt;-</span> <span class="fu">subset</span>(wings, <span class="at">select =</span> <span class="fu">c</span>(loglength, loglifespan, temp, food_level)) </span>
<span id="cb130-9"><a href="#cb130-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb130-10"><a href="#cb130-10" aria-hidden="true" tabindex="-1"></a><span class="co"># remove the row with missing data</span></span>
<span id="cb130-11"><a href="#cb130-11" aria-hidden="true" tabindex="-1"></a>wings <span class="ot">&lt;-</span> <span class="fu">na.omit</span>(wings)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br> <span class="math inline">\star</span> Copy the code above into your script and run it</p>
<p>Check that the data you end up with has this structure:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb131"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb131-1"><a href="#cb131-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(wings)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>'data.frame':   149 obs. of  4 variables:
 $ loglength  : num  1.075 0.952 0.88 0.963 0.824 ...
 $ loglifespan: num  2.08 1.61 1.61 1.79 1.39 ...
 $ temp       : Factor w/ 3 levels "22","26","32": 1 1 1 1 1 1 1 1 1 1 ...
 $ food_level : Factor w/ 2 levels "0.1","1": 1 1 1 1 1 1 1 1 1 1 ...
 - attr(*, "na.action")= 'omit' Named int [1:121] 38 42 60 103 136 142 143 157 158 159 ...
  ..- attr(*, "names")= chr [1:121] "38" "42" "60" "103" ...</code></pre>
</div>
</div>
</section>
<section id="a-maximal-model" class="level2">
<h2 class="anchored" data-anchor-id="a-maximal-model">A Maximal model</h2>
<p>First let’s fit a model including all of these variables and all of the interactions:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb133"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb133-1"><a href="#cb133-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(<span class="at">formula =</span> loglifespan <span class="sc">~</span> loglength <span class="sc">*</span> temp <span class="sc">*</span> food_level, <span class="at">data =</span> wings)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><span class="math inline">\star</span> Add this model-fitting step in your script.</p>
<p><span class="math inline">\star</span> Look at the output of <code>anova(model)</code> and <code>summary(model)</code>.</p>
<p>Scared? Don’t be! There are a number of points to this exercise:</p>
<ol type="1">
<li><p>These tables show exactly the kind of output you’ve seen before. Sure, there are lots of rows but each row is just asking whether a model term (<code>anova</code>) or a model coefficient (<code>summary</code>) is significant.</p></li>
<li><p>Some of the rows are significant, others aren’t: some of the model terms are not explanatory.</p></li>
<li><p>The two tables show similar things - only a few stars for the <code>anova</code> table and the <code>summary</code> table.</p></li>
<li><p>That last line in the <code>anova</code> table: <code>loglength:temp:food_level</code>. This is an interaction of three variables capturing how the slope for lifespan changes for different wing lengths for individuals in different temperature-food levels. Does this seem easy to understand?</p></li>
</ol>
<p>The real lesson here is that it is easy to fit complicated models in R.</p>
<p><em>Understanding and explaining them is a different matter</em>.</p>
<p>The temptation is always to start with the most complex possible model but this is rarely a good idea.</p>
</section>
<section id="a-better-maximal-model" class="level2">
<h2 class="anchored" data-anchor-id="a-better-maximal-model">A better maximal model</h2>
<p>Instead of all possible interactions, we’ll consider two-way interactions: how do pairs of variables affect each other?</p>
<p>There is a shortcut for this: <code>y ~ (a + b + c)^2</code> gets all two way combinations of the variables in the brackets, so is a quicker way of getting this model:</p>
<p><code>y ~ a + b + c + a:b + a:c + b:c</code></p>
<p>So let’s use this to fit a simpler maximal model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb134"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb134-1"><a href="#cb134-1" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> <span class="fu">lm</span>(loglifespan <span class="sc">~</span> (loglength <span class="sc">+</span> temp <span class="sc">+</span> food_level)<span class="sc">^</span><span class="dv">2</span>, <span class="at">data =</span> wings)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The <code>anova</code> table for this model looks like this:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb135"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb135-1"><a href="#cb135-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: loglifespan
                      Df  Sum Sq Mean Sq  F value    Pr(&gt;F)    
loglength              1 29.9465 29.9465 299.2418 &lt; 2.2e-16 ***
temp                   2 17.5835  8.7918  87.8522 &lt; 2.2e-16 ***
food_level             1  0.0488  0.0488   0.4875  0.486215    
loglength:temp         2  1.3925  0.6963   6.9573  0.001319 ** 
loglength:food_level   1  0.1193  0.1193   1.1921  0.276787    
temp:food_level        2  0.5558  0.2779   2.7768  0.065693 .  
Residuals            139 13.9104  0.1001                       
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<p><br> The first lines are the <em>main effects</em>: two are significant and one isn’t. Then there are the three interactions. One of these is very significant: <code>loglength:temp</code>, which suggests that the slope of log lifespan value with wing length differs between temperatures. The other interactions are non-significant although some are close.</p>
<p><span class="math inline">\star</span> Run this model in your script.</p>
<p><span class="math inline">\star</span> Look at the output of <code>anova(model)</code> and <code>summary(model)</code>.</p>
<p><span class="math inline">\star</span> Generate and inspect the model diagnostic plots.</p>
</section>
<section id="model-simplification-1" class="level2">
<h2 class="anchored" data-anchor-id="model-simplification-1">Model simplification</h2>
<p>Now let’s simplify the model we fitted above. Model simplification is not as straightforward as just dropping terms. Each time you remove a term from a model, the model will change: the model will get worse, since some of the sums of squares are no longer explained, but the remaining variables may partly compensate for this loss of explanatory power. The main point is that if it gets only a little worse, its OK, as the tiny amount of additional variation explained by the term you removed is not really worth it.</p>
<p>But how much is “tiny amount”? This is what we will learn now by using the <span class="math inline">F</span>-test. Again, remember: significance of the <span class="math inline">F</span>-test used to compare a model and its simplified counterpart is a <em>bad</em> thing — it means that we’ve removed a term from the fitted model that makes the it <em>significantly</em> worse.</p>
<p>The first question is: <em>what terms can you remove from a model</em>? Obviously, you only want to remove non-significant terms, but there is another rule – you cannot remove a main effect or an interaction while those main effects or interactions are present in a more complex interaction. For example, in the model <code>y ~ a + b + c + a:b + a:c + b:c</code>, you cannot drop <code>c</code> without dropping both <code>a:c</code> and <code>b:c</code>.</p>
<p>The R function <code>drop.scope</code> tells you what you can drop from a model. Some examples:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb137"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb137-1"><a href="#cb137-1" aria-hidden="true" tabindex="-1"></a><span class="fu">drop.scope</span>(model)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "loglength:temp"       "loglength:food_level" "temp:food_level"     </code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb139"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb139-1"><a href="#cb139-1" aria-hidden="true" tabindex="-1"></a><span class="fu">drop.scope</span>(y <span class="sc">~</span> a <span class="sc">+</span> b <span class="sc">+</span> c <span class="sc">+</span> a<span class="sc">:</span>b)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "c"   "a:b"</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb141"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb141-1"><a href="#cb141-1" aria-hidden="true" tabindex="-1"></a><span class="fu">drop.scope</span>(y <span class="sc">~</span> a <span class="sc">+</span> b <span class="sc">+</span> c <span class="sc">+</span> a<span class="sc">:</span>b <span class="sc">+</span> b<span class="sc">:</span>c <span class="sc">+</span> a<span class="sc">:</span>b<span class="sc">:</span>c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "a:b:c"</code></pre>
</div>
</div>
<p><br> The last thing we need to do is work out how to remove a term from a model. We could type out the model again, but there is a shortcut using the function <code>update</code>:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb143"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb143-1"><a href="#cb143-1" aria-hidden="true" tabindex="-1"></a><span class="co"># a simple model</span></span>
<span id="cb143-2"><a href="#cb143-2" aria-hidden="true" tabindex="-1"></a>f <span class="ot">&lt;-</span> y <span class="sc">~</span> a <span class="sc">+</span> b <span class="sc">+</span> c <span class="sc">+</span> b<span class="sc">:</span>c</span>
<span id="cb143-3"><a href="#cb143-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb143-4"><a href="#cb143-4" aria-hidden="true" tabindex="-1"></a><span class="co"># remove b:c from the current model</span></span>
<span id="cb143-5"><a href="#cb143-5" aria-hidden="true" tabindex="-1"></a><span class="fu">update</span>(f, . <span class="sc">~</span> . <span class="sc">-</span> b<span class="sc">:</span>c)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>y ~ a + b + c</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb145"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb145-1"><a href="#cb145-1" aria-hidden="true" tabindex="-1"></a><span class="co"># model g as a response using the same explanatory variables.</span></span>
<span id="cb145-2"><a href="#cb145-2" aria-hidden="true" tabindex="-1"></a><span class="fu">update</span>(f, g <span class="sc">~</span> .)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>g ~ a + b + c + b:c</code></pre>
</div>
</div>
<p><br> Yes, the syntax is weird. The function uses a model or a formula and then allows you to alter the current formula. The dots in the code <code>.&nbsp;~&nbsp;.</code> mean ‘use whatever is currently in the response or explanatory variables’. It gives a simple way of changing a model.</p>
<p>Now that you have learned the syntax, let’s try model simplification with the mammals dataset.</p>
<p>From the above <code>anova</code> and <code>drop.scope</code> output, we know that the interaction <code>loglength:temp:food_level</code> is not significant and a valid term. So, let’s remove this term:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb147"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb147-1"><a href="#cb147-1" aria-hidden="true" tabindex="-1"></a>model2 <span class="ot">&lt;-</span> <span class="fu">update</span>(model, . <span class="sc">~</span> . <span class="sc">-</span> loglength<span class="sc">:</span>temp<span class="sc">:</span>food_level)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p><br> And now use ANOVA to compare the two models:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb148"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb148-1"><a href="#cb148-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(model, model2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Model 1: loglifespan ~ (loglength + temp + food_level)^2
Model 2: loglifespan ~ loglength + temp + food_level + loglength:temp + 
    loglength:food_level + temp:food_level
  Res.Df   RSS Df Sum of Sq F Pr(&gt;F)
1    139 13.91                      
2    139 13.91  0         0         </code></pre>
</div>
</div>
<p><br> This tells us that <code>model2</code> is <em>not</em> significantly worse than <code>model</code>. That is, dropping that one interaction term did not result in much of a loss of predictability.</p>
<p>Now let’s look at this simplified model and see what else can be removed:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb150"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb150-1"><a href="#cb150-1" aria-hidden="true" tabindex="-1"></a><span class="fu">anova</span>(model2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Analysis of Variance Table

Response: loglifespan
                      Df  Sum Sq Mean Sq  F value    Pr(&gt;F)    
loglength              1 29.9465 29.9465 299.2418 &lt; 2.2e-16 ***
temp                   2 17.5835  8.7918  87.8522 &lt; 2.2e-16 ***
food_level             1  0.0488  0.0488   0.4875  0.486215    
loglength:temp         2  1.3925  0.6963   6.9573  0.001319 ** 
loglength:food_level   1  0.1193  0.1193   1.1921  0.276787    
temp:food_level        2  0.5558  0.2779   2.7768  0.065693 .  
Residuals            139 13.9104  0.1001                       
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb152"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb152-1"><a href="#cb152-1" aria-hidden="true" tabindex="-1"></a><span class="fu">drop.scope</span>(model2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "loglength:temp"       "loglength:food_level" "temp:food_level"     </code></pre>
</div>
</div>
<p><br> <span class="math inline">\star</span> Add this first simplification to your script and re-run it.</p>
<p><span class="math inline">\star</span> Look at the output above and decide what is the next possible term to delete</p>
<p><span class="math inline">\star</span> Using the code above as a model, create <code>model3</code> as the next simplification. (remember to use <code>model2</code> in your <code>update</code> call and not <code>model</code>).</p>
</section>
<section id="exercise-1" class="level2">
<h2 class="anchored" data-anchor-id="exercise-1">Exercise</h2>
<p>Now for a more difficult exercise:</p>
<p><span class="math inline">\star</span> Using the code above to guide you, try and find a minimal adequate model that you are happy with. In each step, the output of <code>anova(model, modelN)</code> should be non-significant (where <span class="math inline">N</span> is the current step).</p>
<p>It can be important to consider both <code>anova</code> and <code>summary</code> tables. It can be worth trying to remove things that look significant in one table but not the other — some terms can explain significant variation on the <code>anova</code> table but the coefficients are not significant.</p>
<p>Remember to remove <em>terms</em>: with categorical variables, several coefficients in the <code>summary</code> table may come from one term in the model and have to be removed together.</p>
<p>When you have got your final model, save the model as an R data file: <code>save(modelN, file='myFinalModel.Rda')</code>.</p>
<hr>
<p><a id="fn1"></a> [1]: Here you work with the script file <code>ModelSimp.R</code></p>
</section>
</section>
<section id="group-project" class="level1">
<h1>Group project</h1>
<p>Explore the dataset <code>lmdataset.csv</code> that contains values on trait-temperature relationships in three important vector/pest species. Develop a hypothesis and explore it using linear models. Assess your model’s fit and assumptions.</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>